import{obi as t}from"@iosio/obi";import{eventListener as e,isObj as s}from"@iosio/util";import{render as o}from"@iosio/x";export{Fragment,Host,h,render}from"@iosio/x";class i extends HTMLElement{constructor(i){super(i),this[p]=()=>[this.props,this.prevProps,this.changedProps],this.emit=(t,e,s={},o=this)=>o.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,composed:!0,...s})),this.eventListener=(t,s,o,i)=>this.unsubs.push(e(t,s,o,i)),this.renderer=()=>{o(this.render(this.props,this.state,this),this.shadowRoot||this)},this.unsubSubs=()=>{let{unsubs:t}=this;for(let e=t.length;e--;)t[e]&&t[e]();this.unsubs=[]},this.onStateChange=()=>this.update();const{shadow:n,styles:h,template:a,proxyRefs:c}=this.constructor;n&&this.attachShadow({mode:"open"}),s(h)&&h.global&&!N.get(this.constructor)&&(x()(h.global),N.set(this.constructor,!0));let d=!0,u=t=>{let{options:e={},css:o=""}=s(t)?t:{css:t};this.fallbackCssString=v(this,o,{getStringOnFallback:!1,...e})},b=()=>{h&&u(h),a&&L(this,a)};Object.assign(this,{unsubs:[],refs:c?P(c)(this):{},props:{},prevProps:{},changedProps:[],mounted:new Promise(t=>this.mount=t),initialized:new Promise(t=>this.init=t),update:()=>(this.processing||(this.processing=this.mounted.then(t=>{if(this.render&&this.renderer&&this.renderer(),d){this.unmount=this.didMount(...this[p]())||l;const t=this.propLogic&&this.propLogic(!0);t&&Object.keys(this.props).forEach(e=>{t[e]&&t[e](this.props[e],this.refs)})}else{const t=this.shouldUpdate(...this[p]());if(t||void 0===t){this.didUpdate(...this[p]());const t=this.propLogic&&this.propLogic();t&&this.changedProps.forEach(e=>t[e]&&t[e](this.props[e],this.refs))}}d=!1,this.changedProps=[],this.processing=!1})),this.processing)}),n&&b(),this.initialized.then(()=>{!n&&b(),this.state&&this.unsubs.push((this.state=t(this.state)).$onChange((t,e)=>O(()=>this.onStateChange(t,e)))),this.observe&&[].concat(this.observe).forEach(t=>{s(t)&&t.$onChange&&this.unsubs.push(t.$onChange(this.update))}),this.beforeInitialUpdate(...this[p]()),this.mount()});let m=this.constructor[r],g=m.length;for(;g--;)m[g](this);this.update()}connectedCallback(){this[a]||(this[a]=!0,this.init())}attributeChangedCallback(t,e,s){this[n]!==t&&e!==s&&(this[d(t)]=s)}static get observedAttributes(){let{prototype:t,propTypes:e}=this;return this[r]=[],e?Object.keys(e).map(s=>{let o=c(s),i="any"===e[s]||e[s].name?{type:e[s]}:e[s];return s in t||Object.defineProperty(t,s,{get(){return this.props[s]},set(t){let{value:e,error:r}=b(t,i.type);r&&null!=e&&console.error(`[${s}] must be type [${i.type.name}]`),e!==this.props[s]&&(this.changedProps.push(s),i.reflect&&this.mounted.then(()=>{this[n]=o,u(this,o,i.type!==Boolean||e?e:null),this[n]=!1}),this.prevProps[s]=this.props[s],this.props[s]=e,this.update())}}),i.value&&this[r].push(t=>t[s]=i.value),o}):[]}disconnectedCallback(){let{isConnected:t,unmount:e,willUnmount:s}=this;t||("function"==typeof e&&e(),s(),this.unsubSubs())}didUpdate(){}didMount(){}beforeInitialUpdate(){}shouldUpdate(){}willUnmount(){}}const n=Symbol(),r=Symbol(),a=Symbol(),p=Symbol();let l=()=>{};const c=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase(),d=t=>t.replace(/-(\w)/g,(t,e)=>e.toUpperCase()),u=(t,e,s)=>{null===s||!1===s||"null"===s||"false"===s?t.removeAttribute(e):t.setAttribute(e,"object"==typeof s?JSON.stringify(s):s)},b=(t,e)=>"any"===e?{value:t,error:!1}:((e=e||String)==Boolean?t=[!0,1,"","1","true"].includes(t):"string"==typeof t&&(t=e==Number?Number(t):e==Object||e==Array?JSON.parse(t):t),{}.toString.call(t)==`[object ${e.name}]`?{value:t,error:e==Number&&Number.isNaN(t)}:{value:t,error:!0}),m=t=>document.createElement(t),g=t=>{let e=m("style");return e.appendChild(document.createTextNode(t)),{element:e,update:t=>e.textContent=t}},f=t=>{for(;t.parentNode&&(t=t.parentNode);)if(t instanceof ShadowRoot)return t;return document},y="adoptedStyleSheets"in document,S=":host, *, *::before, *::after {box-sizing: border-box;} ",C=new Map,w=new Map,v=(t,e,s={})=>{const{async:o,getStringOnFallback:i,useStyleTag:n,noDefaultResets:r}=s;e=(t.shadowRoot&&!r?":host, *, *::before, *::after {box-sizing: border-box;} ":"")+(e||s.cssString||"");const h=t.constructor.tag||t.constructor;if(y&&!n){let s=t.shadowRoot||f(t),i=C.get(h);i||(i=new CSSStyleSheet,i[o?"replace":"replaceSync"](e),C.set(h,i)),[].concat(s.adoptedStyleSheets).includes(i)||(s.adoptedStyleSheets=[...s.adoptedStyleSheets,i])}else{if(i)return e;let s=w.get(h);s||(s=g(e).element,w.set(h,s)),(t.shadowRoot||t).appendChild(s.cloneNode(!0))}},N=new Map,x=(t,e)=>{let s=m("style");return t&&(s.id=t),s.appendChild(document.createTextNode("")),(e||document.head).appendChild(s),t=>(s.appendChild(document.createTextNode(t)),s)},P=t=>e=>{let{selector:o=(t=>`#${t}`),selectMethod:i="querySelector"}=s(t)?t:{},n={},r=e.shadowRoot||e;return new Proxy({},{get:(t,e)=>"refreshRefsCache"===e?()=>n={}:(n[e]||(n[e]=r[i](o(e))),n[e])})},M=new Map,L=(t,e)=>{if(!t||!e)return;let s=t.shadowRoot||t,o=t.constructor,i=M.get(o);i||(i=m("template"),i.innerHTML=e,M.set(o,i)),s.appendChild(i.content.cloneNode(!0))};let R=new Promise(t=>t());const O=t=>R.then(t),T=(t,e,s)=>t[s?"setAttribute":"removeAttribute"](e,""),U=t=>{let e=m("template");return e.innerHTML=t,e},k=(t,e)=>{let s=U(e);t.innerHTML="",t.appendChild(s.content.cloneNode(!0))},$=()=>{const t={};return(e,s)=>(t[e]||(t[e]=U(s)),t[e].content.cloneNode(!0))};export{y as CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE,S as DEFAULT_SHADOWROOT_HOST_CSS_RESETS,i as Elemental,$ as TemplateMapFactory,v as adoptStyles,L as appendTemplate,d as attrToProp,T as booleanAttr,m as createElem,g as createStyleTag,U as createTemplate,O as defer,b as formatType,f as getShadowParent,x as headStyleTag,c as propToAttr,P as refs,k as templateToHost,u as updateAttribute};
//# sourceMappingURL=index.js.map
