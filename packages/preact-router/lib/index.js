import{Component as t,h as o}from"preact";import{routing as n}from"@iosio/routing";export{routing}from"@iosio/routing";import{propsChanged as a,isObj as e}from"@iosio/util";import{lazy as i,Suspense as r}from"preact/compat";const{routerSwitch:s}=n;class c extends t{constructor(t){super(t);let o=window.location.pathname;this.unsub=n.$onChange(()=>{const{pathname:t}=n;o!==t&&(this.setState(Object.create(null)),o=t)}),this.initial=!0}shouldComponentUpdate(t){const{next:n,toLast:e,noChange:i,replacedLast:r}=s({pathMap:t.pathMap,noMatch:t.noMatch,root:t.root});this.next=t=>o(n,t);let{pathMap:c,noMatch:p,root:h}=this.props;return t.root!==h||t.noMatch!==p||a(c||{},t.pathMap||{})||!(e||r||i)}componentDidMount(){this.initial=!1}componentWillUnmount(){this.unsub()}render({pathMap:t,noMatch:n,root:a,...e}){return o(this.initial?s({pathMap:t,noMatch:n,root:a}).next:this.next,e)}}const p=(t="")=>`${t} a:hover,${t} a:focus,${t} a:active,${t} a:link,${t} a:visited {color: inherit;text-decoration: none;background-color: transparent;outline: 0;-webkit-tap-highlight-color: transparent;}`,h=p(""),l=t=>e(t)?n.stringifyParams(t):t||"";class u extends t{componentDidMount(){const{listenTo:t,toPath:o,toParams:a}=this.props;if(t){let e,i,r=!1,s=()=>{const{pathname:t,search:o}=location;e=t,i=o,this.setState({isActive:r})};const c=()=>{const{pathname:n,search:c}=location;r=!1,"pathname"===t&&e!==n?(o===n&&(r=!0),s()):"search"===t&&i!==c?(l(a)===c&&(r=!0),s()):"url"===t&&(o+l(a)===n+c&&(r=!0),s())};this.unsub=n.$onChange(c),c(),e=location.pathname,i=location.pathname}}componentWillUnmount(){this.unsub&&this.unsub()}render({element:t,listenTo:a,children:e,href:i,toPath:r=location.pathname,toParams:s,onClick:c,...p},{isActive:h}){const u={...t?{}:{href:i||r+l(s)},onClick:t=>{r&&(t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),n.route(r,s)),c&&c()},...p};return o(t||"a",u,e({...n,isActive:h}))}}const m=(t,n)=>{const a=i(t),e=n||(()=>o("div"));return function(t){return o(r,{fallback:o(e)},o(a,{...t}))}};export{u as Linkage,c as Router,h as anchorTagResetStyles,p as anchorTagResetStylesFn,m as lazyLoader};
