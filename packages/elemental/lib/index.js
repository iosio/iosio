import{isObj as e,isArray as t,eventListener as s,def as o}from"@iosio/util";export{eventListener}from"@iosio/util";const r="adoptedStyleSheets"in document,i=(e,t)=>{let s=document.createElement("style");return e&&(s.id=e),s.appendChild(document.createTextNode("")),(t||document.head).appendChild(s),e=>(s.appendChild(document.createTextNode(e)),s)},n=e=>{for(;e.parentNode&&(e=e.parentNode);)if(e instanceof ShadowRoot)return e;return document},h={},p={},a=":host, *, *::before, *::after {box-sizing: border-box;} ",d=e=>{let t=document.createElement("style");return t.appendChild(document.createTextNode(e)),{element:t,update:e=>t.textContent=e}},l=(e,t,s,o,i)=>{if(s=(t.shadowRoot?":host, *, *::before, *::after {box-sizing: border-box;} ":"")+s,r&&!i){let r=t.shadowRoot||n(t),i=h[e];i||(i=new CSSStyleSheet,i[o?"replace":"replaceSync"](s),h[e]=i),[].concat(r.adoptedStyleSheets).includes(i)||(r.adoptedStyleSheets=[...r.adoptedStyleSheets,i])}else{let o=p[e];o||(o=d(s).element,p[e]=o),(t.shadowRoot||t).appendChild(o.cloneNode(!0))}},c=(e,t)=>(e.shadowRoot||e).querySelector(t),u=(e,t,s)=>t.reduce((t,o)=>(t[o]=c(e,(s||"")+o),t),{}),m=(e,t)=>u(e,t,"#"),b={},g=(e,t,s)=>{if(!e||!t||!s)return;let o=t.shadowRoot||t,r=b[e];r||(r=document.createElement("template"),r.innerHTML=s,b[e]=r),o.appendChild(r.content.cloneNode(!0))},f=(e,t)=>{let s=document.createElement("template");s.innerHTML=t,e.innerHTML="",e.appendChild(s.content.cloneNode(!0))},y=()=>{const e={};return(t,s)=>{if(!e[t]){const o=document.createElement("template");o.innerHTML=s,e[t]=o}return e[t].content.cloneNode(!0)}},S=(e,t)=>!(!e.getAttribute||!e.localName)&&(t=e.getAttribute("is"),e.localName.includes("-")||t&&t.includes("-")),C=(s,o,r)=>{null===r||!1===r||"null"===r||"false"===r?s.removeAttribute(o):s.setAttribute(o,S(s)&&(e(r)||t(r))?JSON.stringify(r):r)},N=e=>e.replace(/([A-Z])/g,"-$1").toLowerCase(),v=e=>e.replace(/-(\w)/g,(e,t)=>t.toUpperCase()),w=(e,t)=>((t=t||String)==Boolean?e=[!0,1,"","1","true"].includes(e):"string"==typeof e&&(e=t==Number?Number(e):t==Object||t==Array?JSON.parse(e):e),{}.toString.call(e)==`[object ${t.name}]`?{value:e,error:t==Number&&Number.isNaN(e)}:{value:e,error:!0}),P=(...e)=>t=>e.reduce((e,t)=>t(e),t),E=Symbol();class x extends HTMLElement{constructor(){super();const{initAttrs:e}=this.constructor,{shadow:t,tag:o,styles:r,template:i}=this.constructor;this.prevProps={},this.props={},this.changedProps=[],this.unsubs=[],this.refs={},t&&this.attachShadow({mode:"open"});const n=this.shadowRoot||this;let h;this.mounted=new Promise(e=>this._mount=e),this.updateStyles=()=>{if(this.updatableStyles){let e=this.updatableStyles(this.props,this.prevProps);if(!e)return;h?h.update(e):(h=d(e),n.appendChild(h.element))}};let p={};this.refs=new Proxy({},{get:(e,t)=>"refreshRefsCache"===t?()=>p={}:(p[t]||(p[t]=n.querySelector("#"+t)),p[t])});const a=()=>{r&&l(o,this,r),i&&g(o,this,i)};t&&a();const c=()=>{if(!t&&a(),this.renderer&&this.renderer(n,this.props,this.prevProps,this.changedProps),this.didMount&&this.didMount(this.props,this.prevProps,this.changedProps),this.hasMounted=!0,this.propLogic){const e=this.propLogic(!0);Object.keys(this.props).forEach(t=>{e[t]&&e[t](this.props[t],this.refs)})}},u=()=>{if(this.renderer&&this.renderer(n,this.props,this.prevProps,this.changedProps),this.didUpdate&&this.didUpdate(this.props,this.prevProps,this.changedProps),this.propLogic){const e=this.propLogic();this.changedProps.forEach(t=>e[t]&&e[t](this.props[t],this.refs))}};this.update=()=>(this.processing||(this.processing=this.mounted.then(e=>{this.hasMounted?u():c(),this.changedProps=[],this.processing=!1})),this.processing);let m=e.length;for(;m--;)e[m](this);this.update(),this.eventListener=(e,t,o,r)=>{this.unsubs.push(s(e,t,o,r))},this.emit=(e,t,s={},o=this)=>o.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,...s})),this.unsubSubs=()=>{this.unsubs.forEach(e=>e&&e())}}connectedCallback(){this.hasMounted||this._mount()}attributeChangedCallback(e,t,s){this[E]!==e&&t!==s&&(this[v(e)]=s)}disconnectedCallback(){this.isConnected||(this.willUnmount(),this.unsubSubs())}static get observedAttributes(){let{prototype:e,propTypes:t}=this;return this.initAttrs=[],t?Object.keys(t).map(s=>{let r=N(s),i=t[s].name?{type:t[s]}:t[s];return s in e||o(e,s,{get(){return this.props[s]},set(e){let{value:t,error:o}=w(e,i.type);o&&null!=t&&console.error(`[${s}] must be type [${i.type.name}]`),t!==this.props[s]&&(this.changedProps.push(s),i.reflect&&this.mounted.then(()=>{this[E]=r,C(this,r,i.type!==Boolean||t?t:null),this[E]=!1}),this.prevProps[s]=this.props[s],this.props[s]=t,this.update())}}),i.value&&this.initAttrs.push(e=>e[s]=i.value),r}):[]}willUnmount(){}}x.define=(...e)=>{e.forEach(e=>{if(!e.tag)return console.error('The Elemental base class requires a tag name on the static "tag" property',e);customElements.define(e.tag,e)})};export{r as CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE,a as DEFAULT_SHADOWROOT_HOST_CSS_RESETS,x as Elemental,y as TemplateMapFactory,l as adoptStyles,g as appendTemplate,v as attrToProp,P as compose,u as createRefs,m as createRefsFromIDs,d as createStyleTag,w as formatType,n as getShadowParent,i as headStyleTag,S as isCustomElement,N as propToAttr,c as select,f as templateToHost,C as updateAttribute};
//# sourceMappingURL=index.js.map
