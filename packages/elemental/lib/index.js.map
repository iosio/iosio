{"version":3,"file":"index.js","sources":["../src/util.js","../src/BaseElement.js","../src/adoptableStyles.js","../src/propLogic.js","../src/proxyRefs.js","../src/reactiveProps.js","../src/reactiveState.js","../src/staticTemplate.js","../src/updatableStyles.js","../src/events.js","../src/Elemental.js","../src/ShadowElement.js","../src/vdom.js"],"sourcesContent":["import {eventListener} from \"@iosio/util\";\nimport {isString} from \"@iosio/util\";\n\nexport {eventListener}\n\nexport const createDom = ({type, tag, value, attrs = {}, props = {}, children = []}) => {\n    let dom = type === 'fragment'\n        ? document.createDocumentFragment()\n        : (type === 'text' ? document.createTextNode(value) : document.createElement(tag));\n    for (let a in attrs) dom.setAttribute(a, attrs[a]);\n    for (let p in props) {\n        if (p === 'ref') props[p](dom);\n        else if (p === 'style' && isString(p)) dom.style.cssText = props[p];\n        else dom[p] = props[p];\n    }\n    children.forEach(child => dom.appendChild(createDom(child)));\n    return dom;\n};\n\n/*------------------ STYLES -------------------------- */\n\n/**\n * creates a single style sheet. returns a function to update the same sheet\n * @param id\n * @param {node|| null} mount - pass the node to mount the style element to defaults to document head\n * @returns {function} for adding styles to the same stylesheet\n */\nexport const headStyleTag = (id, mount) => {\n    let style = document.createElement('style');\n    if (id) style.id = id;\n    style.appendChild(document.createTextNode(\"\"));\n    (mount || document.head).appendChild(style);\n    return (css) => (style.appendChild(document.createTextNode(css)), style);\n};\n\n\nexport const getShadowParent = elmnt => {\n    while (elmnt.parentNode && (elmnt = elmnt.parentNode)) if (elmnt instanceof ShadowRoot) return elmnt;\n    return document;\n};\n\n\nexport const createStyleTag = (css) => {\n    let style = document.createElement('style');\n    style.appendChild(document.createTextNode(css));\n    return {\n        element: style,\n        update: (css) => style.textContent = css\n    };\n};\n\n/*------------------ TEMPLATES -------------------------- */\n\nconst createTemplate = html => {\n    let temp = document.createElement('template');\n    temp.innerHTML = html;\n    return temp;\n}\n\nexport const templateToHost = (host, html) => {\n    let temp = createTemplate(html);\n    host.innerHTML = '';\n    host.appendChild(temp.content.cloneNode(true));\n};\n\nexport const TemplateMapFactory = () => {\n    const cache = {};\n    return (id, content) => {\n        if (!cache[id]) {\n            cache[id] = createTemplate(content);\n        }\n        return cache[id].content.cloneNode(true);\n    }\n};\n\n\n/*------------------ WEB COMPONENT -------------------------- */\n\nexport const compose = (...mixins) => base => mixins.reduce((acc, curr) => (acc = curr(acc), acc), base);\n\n/*------------------ MISC HELPERS -------------------------- */\n\nexport const booleanAttr = (ref, attr, bool) => ref[!!bool ? 'setAttribute' : 'removeAttribute'](attr, '');\n\n\n\n","import {eventListener} from \"@iosio/util\";\n\nexport class BaseElement extends HTMLElement {\n    constructor() {\n        super();\n        const {shadow} = this.constructor;\n        shadow && this.attachShadow({mode: 'open'});\n        this.unsubs = [];\n        this.eventListener = (to, ev, cb, opts) => this.unsubs.push(eventListener(to, ev, cb, opts));\n        this.emit = (event, detail, opts = {}, from = this) => from.dispatchEvent(new CustomEvent(event, {\n            detail: detail,\n            bubbles: true,\n            composed: true, ...opts\n        }));\n        this.unsubSubs = () => {\n            this.unsubs.forEach(f => f && f());\n        }\n    }\n\n    disconnectedCallback() {\n        if (this.isConnected) return;\n        this.willUnmount && this.willUnmount();\n        this.unsubs.length && this.unsubSubs();\n    }\n}","import {\n    createStyleTag,\n    getShadowParent\n} from \"./util\";\n\nexport const CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE = \"adoptedStyleSheets\" in document;\nexport const DEFAULT_SHADOWROOT_HOST_CSS_RESETS = `:host, *, *::before, *::after {box-sizing: border-box;} `;\n\nconst constructableStyleCache = new Map();\nconst constructableStyleTagFallbackCache = new Map();\n\nexport const adoptStyles = (element, cssString, options = {}) => {\n    const {async, useStyleTag, noDefaultResets} = options;\n\n    cssString = (element.shadowRoot && !noDefaultResets ? DEFAULT_SHADOWROOT_HOST_CSS_RESETS : '') + (cssString || options.cssString || '');\n\n    const signature = element.constructor.tag || element.constructor;\n\n    if (CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE && !useStyleTag) {\n        let adopter = element.shadowRoot || getShadowParent(element);\n        let constructable = constructableStyleCache.get(signature);\n        if (!constructable) {\n            constructable = new CSSStyleSheet();\n            constructable[async ? 'replace' : 'replaceSync'](cssString);\n            constructableStyleCache.set(signature, constructable);\n        }\n        if (!([].concat(adopter.adoptedStyleSheets).includes(constructable))) {\n            adopter.adoptedStyleSheets = [...adopter.adoptedStyleSheets, constructable];\n        }\n    } else {\n        let style = constructableStyleTagFallbackCache.get(signature);\n        if (!style) {\n            style = createStyleTag(cssString).element;\n            constructableStyleTagFallbackCache.set(signature, style);\n        }\n        (element.shadowRoot || element).appendChild(style.cloneNode(true));\n    }\n};\n\n\nexport const adoptableStyles = base => class extends base {\n    constructor() {\n        super();\n        this._adoptify = () => adoptStyles(this, this.constructor.styles, this.constructor.adoptableStyles);\n        this.shadowRoot && this._adoptify();\n    }\n\n    connectedCallback() {\n        if (super.connectedCallback) super.connectedCallback();\n        !this.shadowRoot && this._adoptify();\n    }\n};","export const propLogic = base => {\n    if(!base.__reactivePropsMixin || !base.__proxyRefsMixin){\n        console.error('propLogic requires both reactiveProps and proxyRefs mixins');\n        return base;\n    }\n\n    return class extends base {\n\n        initialUpdate() {\n            if (this.propLogic) {\n                const logic = this.propLogic(true);\n                Object.keys(this.props).forEach(prop => {\n                    logic[prop] && logic[prop](this.props[prop], this.refs);\n                });\n            }\n        }\n\n        subsequentUpdate() {\n            if (this.propLogic) {\n                const logic = this.propLogic();\n                this.changedProps.forEach(prop => logic[prop] && logic[prop](this.props[prop], this.refs))\n            }\n        }\n    }\n};\n\n","export const proxyRefs = base => class extends base {\n    static __proxyRefsMixin = true;\n    constructor() {\n        super();\n        const proxyRefs = this.constructor.proxyRefs || {};\n        const selectMethod = proxyRefs.selectMethod || 'querySelector';\n        const selectorPrepend = proxyRefs.selectorPrepend || '#';\n        const selectorAppend = proxyRefs.selectorAppend || '';\n        let refsCache = {};\n        const root = this.shadowRoot || this;\n        this.refs = new Proxy({}, {\n            get(target, key) {\n                if (key === 'refreshRefsCache') return () => refsCache = {};\n                if (!refsCache[key]) refsCache[key] = root[selectMethod](selectorPrepend + key + selectorAppend);\n                return refsCache[key];\n            }\n        });\n    }\n};","import {isArray, isObj} from \"@iosio/util\";\n\nexport const propToAttr = (prop) => prop.replace(/([A-Z])/g, \"-$1\").toLowerCase();\nexport const attrToProp = (attr) => attr.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\nexport const isCustomElement = (el, isAttr) => {\n    if (!el.getAttribute || !el.localName) return false;\n    isAttr = el.getAttribute('is');\n    return el.localName.includes('-') || isAttr && isAttr.includes('-');\n};\nexport const updateAttribute = (node, attr, value) => {\n    (value === null || value === false || value === 'null' || value === 'false')\n        ? node.removeAttribute(attr)\n        : node.setAttribute(attr, isCustomElement(node) && (isObj(value) || isArray(value)) ? JSON.stringify(value) : value);\n};\n\n/**\n * for parsing the incoming attributes into consumable props\n * @param value\n * @param type\n * @returns {{error: boolean, value: *}}\n */\nexport const formatType = (value, type) => {\n    type = type || String;\n    if (type == Boolean) value = [true, 1, \"\", \"1\", \"true\"].includes(value);\n    else if (typeof value == \"string\") {\n        value = type == Number\n            ? Number(value) : type == Object || type == Array\n                ? JSON.parse(value) : value;\n    }\n    if (type === 'any') return {value, error: false};\n    if ({}.toString.call(value) == `[object ${type.name}]`) return {\n        value,\n        error: type == Number && Number.isNaN(value)\n    };\n    return {value, error: true};\n};\n\n\nconst IGNORE_ATTR = Symbol();\nexport const reactiveProps = base => class extends base {\n    static __reactivePropsMixin = true;\n\n    constructor() {\n        super();\n        const {initAttrs} = this.constructor;\n        this.prevProps = {};\n        this.props = {};\n        this.changedProps = [];\n        this.hasMounted = false;\n        this.mounted = new Promise(mount => (this._mount = mount));\n        let length = initAttrs.length;\n        while (length--) initAttrs[length](this);\n        this.update();\n    }\n\n    connectedCallback() {\n        if (super.connectedCallback) super.connectedCallback();\n        if (!this.hasMounted) this._mount();\n    }\n\n\n    update() {\n        if (!this.processing) this.processing = this.mounted.then(_ => {\n            !this.hasMounted ? this._initialUpdate() : this._subsequentUpdate();\n            this.changedProps = [];\n            this.processing = false;\n        });\n        return this.processing;\n    }\n\n    beforeInitialUpdate() {\n    }\n\n    _initialUpdate() {\n        this.beforeInitialUpdate(this.props, this.prevProps, this.changedProps);\n        this.initialUpdate();\n        this.didMount && this.didMount(this.props, this.prevProps, this.changedProps);\n        this.hasMounted = true;\n    }\n\n    initialUpdate() {\n    }\n\n    shouldUpdate(props, prevProps, changedProps) {\n\n    }\n\n    _subsequentUpdate() {\n        const shouldUpdate = this.shouldUpdate(this.props, this.prevProps, this.changedProps);\n        if (shouldUpdate || shouldUpdate === undefined) {\n            this.subsequentUpdate();\n            this.didUpdate && this.didUpdate(this.props, this.prevProps, this.changedProps);\n        }\n    }\n\n    subsequentUpdate() {\n    }\n\n    attributeChangedCallback(attr, oldValue, newValue) {\n        if (super.attributeChangedCallback) super.attributeChangedCallback(attr, oldValue, newValue);\n        if (this[IGNORE_ATTR] === attr || oldValue === newValue) return;\n        this[attrToProp(attr)] = newValue;\n    }\n\n    disconnectedCallback() {\n        if (this.isConnected) return;\n        this.willUnmount && this.willUnmount();\n    }\n\n    static get observedAttributes() {\n        let {prototype, propTypes} = this;\n        this.initAttrs = [];\n        if (!propTypes) return [];\n        return Object.keys(propTypes).map(prop => {\n            let attr = propToAttr(prop);\n            let schema = propTypes[prop].name ? {type: propTypes[prop]} : propTypes[prop];\n            if (!(prop in prototype)) {\n                Object.defineProperty(prototype, prop, {\n                    get() {\n                        return this.props[prop]\n                    },\n                    set(nextValue) {\n                        let {value, error} = formatType(nextValue, schema.type);\n                        if (error && value != null) console.error(`[${prop}] must be type [${schema.type.name}]`);\n                        if (value === this.props[prop]) return;\n                        this.changedProps.push(prop);\n                        if (schema.reflect) {\n                            this.mounted.then(() => {\n                                this[IGNORE_ATTR] = attr;\n                                updateAttribute(this, attr, schema.type === Boolean && !value ? null : value);\n                                this[IGNORE_ATTR] = false;\n                            });\n                        }\n                        this.prevProps[prop] = this.props[prop];\n                        this.props[prop] = value;\n                        this.update();\n                    }\n                });\n            }\n            schema.value && this.initAttrs.push(self => (self[prop] = schema.value));\n            return attr;\n        });\n    }\n};","import {obi} from \"@iosio/obi\";\nimport {isObj, isFunc} from \"@iosio/util\";\n\nexport const reactiveState = base =>{\n    return class extends base {\n        connectedCallback() {\n            super.connectedCallback && super.connectedCallback();\n            if (isObj(this.state)) {\n                this.state = obi(this.state);\n                const onChange = isFunc(this.onStateChange) ? this.onStateChange : () => {\n                    this.stateChanged = true;\n                    this.update && this.update().then(() => this.stateChanged = false);\n                };\n                this.__unsubStateChange = this.state.$onChange(onChange);\n            }\n        }\n\n        disconnectedCallback() {\n            if (super.disconnectedCallback) super.disconnectedCallback();\n            if (this.isConnected) return;\n            if (this.__unsubStateChange) this.__unsubStateChange();\n        }\n    }\n};","const tagTemplateCache = new Map();\nexport const appendTemplate = (element, templateStr) => {\n    if (!element || !templateStr) return;\n    let el = element.shadowRoot || element,\n        signature = element.constructor,\n        temp = tagTemplateCache.get(signature);\n    if (!temp) {\n        temp = document.createElement('template');\n        temp.innerHTML = templateStr;\n        tagTemplateCache.set(signature, temp);\n    }\n    el.appendChild(temp.content.cloneNode(true));\n};\n\n\nexport const staticTemplate = base => class extends base {\n    constructor() {\n        super();\n        const temp = this.constructor.template;\n        this._templify = () => temp && appendTemplate(this, temp);\n        this.shadowRoot && this._templify();\n    }\n\n    connectedCallback() {\n        if (super.connectedCallback) super.connectedCallback();\n        !this.shadowRoot && this._templify();\n    }\n};","import {createStyleTag} from \"./util\";\n\nexport const updatableStyles = base => class extends base {\n    constructor() {\n        super();\n        let updatableStyleTag;\n        this.updateStyles = () => {\n            if (this.updatableStyles) {\n                let css = this.updatableStyles(this.props, this.prevProps);\n                if (!css) return;\n                if (!updatableStyleTag) {\n                    updatableStyleTag = createStyleTag(css);\n                    (this.shadowRoot || this).appendChild(updatableStyleTag.element)\n                } else updatableStyleTag.update(css);\n            }\n        };\n    }\n};","import {eventListener} from \"@iosio/util\";\n\nexport const events = base => class extends base {\n    constructor() {\n        super();\n        this.unsubs = [];\n        this.eventListener = (to, ev, cb, opts) => this.unsubs.push(eventListener(to, ev, cb, opts));\n        this.emit = (event, detail, opts = {}, from = this) => from.dispatchEvent(new CustomEvent(event, {\n            detail: detail,\n            bubbles: true,\n            composed: true, ...opts\n        }));\n        this.unsubSubs = () => {\n            this.unsubs.forEach(f => f && f());\n        }\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback && super.disconnectedCallback();\n        if (this.isConnected) return;\n        this.unsubs.length && this.unsubSubs();\n    }\n};","import {compose} from \"./util\";\nimport {BaseElement} from \"./BaseElement\";\nimport {adoptableStyles} from \"./adoptableStyles\";\nimport {propLogic} from \"./propLogic\";\nimport {proxyRefs} from \"./proxyRefs\";\nimport {reactiveProps} from \"./reactiveProps\";\nimport {reactiveState} from \"./reactiveState\";\nimport {staticTemplate} from \"./staticTemplate\";\nimport {updatableStyles} from \"./updatableStyles\";\nimport {events} from \"./events\";\n\nexport const Elemental = compose(\n    reactiveProps,\n    reactiveState,\n    adoptableStyles,\n    staticTemplate,\n    updatableStyles,\n    proxyRefs,\n    propLogic,\n    events\n)(class extends HTMLElement {\n    constructor() {\n        super();\n        const {shadow} = this.constructor;\n        shadow && this.attachShadow({mode: 'open'});\n    }\n});\n\nElemental.define = (...elements) => {\n    elements.forEach((e) => {\n        if (!e.tag) return console.error('The Elemental base class requires a tag name on the static \"tag\" property', e);\n        customElements.define(e.tag, e);\n    })\n};","export class ShadowElement extends HTMLElement{\n    constructor() {\n        super();\n        this.attachShadow({mode:'open'});\n    }\n}","import {render, Fragment, h, toChildArray} from \"@iosio/xact\";\n\nexport {Fragment, h, toChildArray, render};\n\nexport const vdom = (base) => {\n    if(!base.__reactivePropsMixin){\n        console.error('vdom requires reactiveProps mixin');\n        return base;\n    }\n    return class extends base {\n        renderer() {\n            this.render && render(this.render(this.props, this.state), this.shadowRoot || this);\n        }\n\n        initialUpdate() {\n            this.renderer();\n        }\n\n        subsequentUpdate() {\n            this.renderer();\n        }\n\n        disconnectedCallback() {\n            if(super.disconnectedCallback)super.disconnectedCallback();\n            if (!this.isConnected) {\n                this.render && render(null, this.shadowRoot || this);\n            }\n        }\n    }\n};"],"names":["createDom","type","tag","value","attrs","props","children","dom","document","createDocumentFragment","createTextNode","createElement","a","setAttribute","p","isString","style","cssText","forEach","child","appendChild","headStyleTag","id","mount","head","css","getShadowParent","elmnt","parentNode","ShadowRoot","createStyleTag","element","update","textContent","createTemplate","html","temp","innerHTML","templateToHost","host","content","cloneNode","TemplateMapFactory","cache","compose","mixins","base","reduce","acc","curr","booleanAttr","ref","attr","bool","BaseElement","HTMLElement","constructor","super","shadow","this","attachShadow","mode","unsubs","eventListener","to","ev","cb","opts","push","emit","event","detail","from","dispatchEvent","CustomEvent","bubbles","composed","unsubSubs","f","disconnectedCallback","isConnected","willUnmount","length","CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE","constructableStyleCache","Map","constructableStyleTagFallbackCache","adoptableStyles","_adoptify","cssString","options","async","useStyleTag","noDefaultResets","shadowRoot","signature","adopter","constructable","get","CSSStyleSheet","set","concat","adoptedStyleSheets","includes","adoptStyles","styles","connectedCallback","propLogic","__reactivePropsMixin","__proxyRefsMixin","initialUpdate","logic","Object","keys","prop","refs","subsequentUpdate","changedProps","console","error","proxyRefs","selectMethod","selectorPrepend","selectorAppend","refsCache","root","Proxy","target","key","IGNORE_ATTR","Symbol","reactiveProps","initAttrs","prevProps","hasMounted","mounted","Promise","_mount","processing","then","_","_subsequentUpdate","_initialUpdate","beforeInitialUpdate","didMount","shouldUpdate","undefined","didUpdate","attributeChangedCallback","oldValue","newValue","replace","all","letter","toUpperCase","attrToProp","observedAttributes","prototype","propTypes","map","toLowerCase","propToAttr","schema","name","defineProperty","nextValue","String","Boolean","Number","Array","JSON","parse","toString","call","isNaN","formatType","reflect","node","el","isAttr","removeAttribute","getAttribute","localName","isObj","isArray","stringify","updateAttribute","self","reactiveState","state","obi","onChange","isFunc","onStateChange","stateChanged","__unsubStateChange","$onChange","tagTemplateCache","staticTemplate","template","_templify","templateStr","appendTemplate","updatableStyles","updatableStyleTag","updateStyles","events","Elemental","define","elements","e","customElements","ShadowElement","vdom","renderer","render"],"mappings":"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"}