{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {extend} from \"@iosio/util\";\nimport {routing} from \"@iosio/routing\";\n\nexport {routing};\n\nexport const CustomElementsRouter = ({transition, pathMap, noMatch, loadingIndicator, lazyMap}) => {\n\n    transition = typeof transition === 'number'\n        ? transition : transition === true ? 150 : 0;\n\n    var initial = true, elem, getMountPoint, timeout,\n        unsub, transitionStyle = `opacity ${transition}ms ease-in-out`,\n        {routerSwitch} = routing, CE = customElements,\n\n        clearMountingPoint = (e) => {\n            let child = e.lastElementChild;\n            while (child) (e.removeChild(child), child = e.lastElementChild)\n        },\n\n        m = (parentNode, elem) => (clearMountingPoint(parentNode), parentNode.appendChild(elem)),\n\n        mount = (elementName, parentNode) => {\n            clearTimeout(timeout);\n            elem = document.createElement(elementName);\n            if (initial || !transition) return m(parentNode, elem);\n            extend(parentNode.style, {transition: transitionStyle, opacity: 0});\n            timeout = setTimeout(() => {\n                m(parentNode, elem);\n                extend(parentNode.style, {transition: transitionStyle, opacity: 1})\n            }, transition ? transition + 10 : 0);\n        },\n\n        mountLazy = (elementName, to) => {\n            loadingIndicator && mount(loadingIndicator, to);\n            lazyMap && lazyMap[elementName] && lazyMap[elementName]().then(() =>\n                CE.whenDefined(elementName).then(() =>\n                    // in case of slow network and the user decides to locate somewhere else before\n                    // the request has finished, check that the pathMap matches the element name before exec the mount\n                    // so that the previously requested element doesn't mount over the current\n                    pathMap[location.pathname] === elementName && mount(elementName, to)\n                ));\n        },\n\n        doRoute = () => {\n            let {next, toLast, noChange, replacedLast} = routerSwitch({pathMap, noMatch}),\n\n                parentNode = getMountPoint && getMountPoint();\n\n            if (!(parentNode && parentNode.nodeName) || toLast || replacedLast || (noChange && !initial)) return;\n\n            next && CE.get(next) ? mount(next, parentNode) : mountLazy(next, parentNode);\n        };\n\n    return {\n        mountTo: getNodeToMountToFunction => {\n            unsub && unsub(); // you didn't follow directions!!!\n            getMountPoint = getNodeToMountToFunction;\n            doRoute();\n            initial = false;\n            unsub = routing.$onChange(doRoute);\n            return unsub;\n        }\n    }\n};\n"],"names":["CustomElementsRouter","transition","pathMap","noMatch","loadingIndicator","lazyMap","elem","getMountPoint","timeout","unsub","initial","transitionStyle","routerSwitch","routing","CE","customElements","m","parentNode","e","child","lastElementChild","removeChild","appendChild","mount","elementName","clearTimeout","document","createElement","extend","style","opacity","setTimeout","doRoute","next","toLast","noChange","replacedLast","to","nodeName","get","then","whenDefined","location","pathname","mountTo","getNodeToMountToFunction","$onChange"],"mappings":"kHAKaA,MAAAA,EAAuB,EAAEC,WAAAA,EAAYC,QAAAA,EAASC,QAAAA,EAASC,iBAAAA,EAAkBC,QAAAA,MAKlF,IAAoBC,EAAMC,EAAeC,EACrCC,EADAC,KACOC,EAAmB,WAJ9BV,EAAmC,iBAAfA,EACdA,OAAaA,EAAsB,IAAM,mBAI3CW,aAACA,GAAgBC,EAASC,EAAKC,eAO/BC,EAAI,CAACC,EAAYX,KALKY,CAAAA,IAClB,IAAIC,EAAQD,EAAEE,iBACd,KAAOD,GAAQD,EAAEG,YAAYF,GAAQA,EAAQD,EAAEE,kBAF7BF,CAKwBD,GAAaA,EAAWK,YAAYhB,IAElFiB,EAAQ,CAACC,EAAaP,KAGlB,GAFAQ,aAAajB,GACbF,EAAOoB,SAASC,cAAcH,GAC1Bd,IAAYT,EAAY,OAAOe,EAAEC,EAAYX,GACjDsB,EAAOX,EAAWY,MAAO,CAAC5B,WAAYU,EAAiBmB,QAAS,IAChEtB,EAAUuB,WAAW,KACjBf,EAAEC,EAAYX,GACdsB,EAAOX,EAAWY,MAAO,CAAC5B,WAAYU,EAAiBmB,QAAS,KACjE7B,EAAaA,EAAa,GAAK,IActC+B,EAAU,KACN,IAAIC,KAACA,EAADC,OAAOA,EAAPC,SAAeA,EAAfC,aAAyBA,GAAgBxB,EAAa,CAACV,QAAAA,EAASC,QAAAA,IAEhEc,EAAaV,GAAiBA,IAd1B,IAACiB,EAAaa,GAgBhBpB,IAAcA,EAAWqB,UAAaJ,GAAUE,GAAiBD,IAAazB,IAEpFuB,GAAQnB,EAAGyB,IAAIN,GAAQV,EAAMU,EAAMhB,IAlB1BO,EAkBkDS,EAlBrCI,EAkB2CpB,EAjBjEb,GAAoBmB,EAAMnB,EAAkBiC,GAC5ChC,GAAWA,EAAQmB,IAAgBnB,EAAQmB,KAAegB,KAAK,IAC3D1B,EAAG2B,YAAYjB,GAAagB,KAAK,IAI7BtC,EAAQwC,SAASC,YAAcnB,GAAeD,EAAMC,EAAaa,QAcjF,MAAO,CACHO,QAASC,IACLpC,GAASA,IACTF,EAAgBsC,EAChBb,IACAtB,KACAD,EAAQI,EAAQiC,UAAUd"}