{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {lorem} from \"@iosio/lorem\";\nimport {debounce} from \"@iosio/util\";\nimport {obi} from \"@iosio/obi\";\n\nconst todoStubs = [\n    'Make sweet library', 'make cool apps',\n    'test library', 'go buy dog food', 'register vehicles'\n];\n\nlet count = 0;\nconst defaultTodos = todoStubs.map((name) => ({id: count++, name, completed: false}));\nPromise.pending = Promise.race.bind(Promise, []);\n\nlet cancel = () => {\n};\n\nimport('./worker');\nlet searching = false;\nconst workerSearch = (value_, list_) => {\n    searching = true;\n    //hack for safari -- system js doesn't like it\n    return import('./worker').then(({searchWorker}) =>\n        new Promise(resolveIt => {\n            cancel = () => resolveIt(Promise.pending());\n            searchWorker({value: value_, list: list_}).then(resolveIt);\n        }))\n};\n\n\nlet resultsCache = {};\nconst clearCache = () => resultsCache = {};\n\nlet clearAfterCreate = ()=>{};\n\nconst setSearchValue = value => {\n    if (searching) {\n        cancel();\n        searching = false;\n    }\n    todos.searchValue = value;\n    value = value.toLowerCase();\n\n    if (value.length === 0) {\n        todos.displayList = [...todos.list];\n    } else if (resultsCache[value]) {\n        todos.displayList = resultsCache[value];\n    } else {\n        workerSearch(value, todos.list)\n            .then(({update, originalSearch}) => {\n                resultsCache[originalSearch] = update;\n                if (value === originalSearch && value.length !== 0) {\n                    todos.displayList = update;\n                } else if (value.length === 0) {\n                    todos.displayList = [...todos.list];\n                }\n            });\n\n    }\n};\nconst debouncedSearch = debounce(setSearchValue, 2);\n\n\nexport const todos = obi({\n    list: defaultTodos,\n    displayList: defaultTodos,\n    todoName: '',\n    searchValue: '',\n    testValue: true,\n    makeABunch() {\n        clearAfterCreate();\n        todos.displayList = todos.list = [\n            ...todos.list,\n            ...lorem().split(' ').map((name) => ({id: count++, name: name + ` ${count}`, completed: false}))\n        ];\n    },\n    removeTodo(todo) {\n        let updated = todos.list.filter(mt => mt.id !== todo.id),\n            filtered = todos.searchValue.length === 0\n                ? updated\n                : updated.filter(t => t.name.search(todos.searchValue) !== -1);\n        todos.list = [...updated];\n        todos.displayList = [...filtered]\n    },\n    setSearchValueDebounced: debouncedSearch,\n    setSearchValue,\n    addTodo(e) {\n        e && e.preventDefault();\n        todos.list.push({\n            name: todos.todoName,\n            id: count++,\n            completed: false\n        });\n        clearCache();\n        todos.displayList = todos.list = [...todos.list];\n        todos.searchValue = todos.todoName = '';\n    },\n    captureEnter(e) {\n        if (((e.keyCode || e.which) === 13)) todos.addTodo(e);\n    }\n});\n\n"],"names":["count","defaultTodos","map","name","id","completed","Promise","pending","race","bind","cancel","import","searching","resultsCache","setSearchValue","value","value_","list_","todos","searchValue","toLowerCase","length","displayList","list","then","searchWorker","resolveIt","update","originalSearch","obi","todoName","testValue","makeABunch","lorem","split","removeTodo","todo","updated","filter","mt","filtered","t","search","setSearchValueDebounced","debounce","addTodo","e","preventDefault","push","captureEnter","keyCode","which"],"mappings":"6GASA,IAAIA,EAAQ,EACZ,MAAMC,EANY,CACd,qBAAsB,iBACtB,eAAgB,kBAAmB,qBAIRC,IAAKC,KAAWC,GAAIJ,IAASG,KAAAA,EAAME,WAAW,KAC7EC,QAAQC,QAAUD,QAAQE,KAAKC,KAAKH,QAAS,IAE7C,IAAII,EAAS,OAGbC,OAAO,eACP,IAAIC,GAAY,EAYZC,EAAe,GACnB,MAIMC,EAAiBC,IAhBF,IAACC,EAAQC,EAiBtBL,IACAF,IACAE,GAAY,GAEhBM,EAAMC,YAAcJ,EAGC,KAFrBA,EAAQA,EAAMK,eAEJC,OACNH,EAAMI,YAAc,IAAIJ,EAAMK,MACvBV,EAAaE,GACpBG,EAAMI,YAAcT,EAAaE,IA3BnBC,EA6BDD,EA7BSE,EA6BFC,EAAMK,KA5B9BX,GAAY,SAEE,eAAYY,KAAK,EAAEC,aAAAA,KAC7B,IAAInB,QAAQoB,IACRhB,EAAS,IAAMgB,EAAUpB,QAAQC,WACjCkB,EAAa,CAACV,MAAOC,EAAQO,KAAMN,IAAQO,KAAKE,OAwB/CF,KAAK,EAAEG,OAAAA,EAAQC,eAAAA,MACZf,EAAae,GAAkBD,EAC3BZ,IAAUa,GAAmC,IAAjBb,EAAMM,OAClCH,EAAMI,YAAcK,EACI,IAAjBZ,EAAMM,SACbH,EAAMI,YAAc,IAAIJ,EAAMK,UASrCL,EAAQW,EAAI,CACrBN,KAAMtB,EACNqB,YAAarB,EACb6B,SAAU,GACVX,YAAa,GACbY,WAAW,EACXC,aAEId,EAAMI,YAAcJ,EAAMK,KAAO,IAC1BL,EAAMK,QACNU,IAAQC,MAAM,KAAKhC,IAAKC,KAAWC,GAAIJ,IAASG,KAAMA,EAAQ,IAAGH,IAASK,WAAW,OAGhG8B,WAAWC,GACP,IAAIC,EAAUnB,EAAMK,KAAKe,OAAOC,GAAMA,EAAGnC,KAAOgC,EAAKhC,IACjDoC,EAAwC,IAA7BtB,EAAMC,YAAYE,OACvBgB,EACAA,EAAQC,OAAOG,IAA2C,IAAtCA,EAAEtC,KAAKuC,OAAOxB,EAAMC,cAClDD,EAAMK,KAAO,IAAIc,GACjBnB,EAAMI,YAAc,IAAIkB,IAE5BG,wBAxBoBC,EAAS9B,EAAgB,GAyB7CA,eAAAA,EACA+B,QAAQC,GACJA,GAAKA,EAAEC,iBACP7B,EAAMK,KAAKyB,KAAK,CACZ7C,KAAMe,EAAMY,SACZ1B,GAAIJ,IACJK,WAAW,IA5DEQ,EAAe,GA+DhCK,EAAMI,YAAcJ,EAAMK,KAAO,IAAIL,EAAMK,MAC3CL,EAAMC,YAAcD,EAAMY,SAAW,IAEzCmB,aAAaH,GACuB,MAA1BA,EAAEI,SAAWJ,EAAEK,QAAgBjC,EAAM2B,QAAQC"}