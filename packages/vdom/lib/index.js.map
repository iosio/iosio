{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["let eventProxy = function (e) {\n        return this.__ev[e.type](e);\n    },\n\n    IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,\n\n    setStyleProp = (style, key, value) => key[0] === '-' ? style.setProperty(key, value)\n        : (style[key] = typeof value === 'number'\n        && IS_NON_DIMENSIONAL.test(key) === false ? value + 'px' : value == null ? '' : value),\n\n    setStyle = (dom, value, oldValue, _style = dom.style) => {\n        if (typeof value === 'string') return _style.cssText = value;\n        typeof oldValue === 'string' && (_style.cssText = '', oldValue = null);\n        if (oldValue) for (let i in oldValue) if (!(value && i in value)) setStyleProp(_style, i, '');\n        if (value) for (let i in value) if (!oldValue || value[i] !== oldValue[i]) setStyleProp(_style, i, value[i]);\n    },\n\n    setProperty = (dom, name, value, oldValue, _style, _useCapture, _nameLower, _newHTML, _skip) =>\n        ((name === 'style' ? setStyle(dom, value, oldValue)\n            : name[0] === 'o' && name[1] === 'n'\n                ? (_useCapture = name !== (name = name.replace(/Capture$/, '')),\n                    _nameLower = name.toLowerCase(),\n                    name = (_nameLower in dom ? _nameLower : name).slice(2),\n                    value ? (!oldValue && dom.addEventListener(name, eventProxy, _useCapture),\n                            (dom.__ev || (dom.__ev = {}))[name] = value\n                    ) : dom.removeEventListener(name, eventProxy, _useCapture))\n                : (name === 'dangerouslySetInnerHTML' && (value || oldValue))\n                    ? ((!value || !oldValue || value.__html != oldValue.__html)\n                    && (dom.innerHTML = (value && value.__html) || ''), _skip = true) //skip diff children\n                    : (!(['list', 'tagName', 'form', 'type', 'size'].includes(name)) && name in dom)\n                        ? dom[name] = value === null ? '' : value\n                        : name === 'ref' && typeof value === 'function'\n                            ? value(dom) : typeof value !== 'function' && (\n                            (value === null || (value === false && !/^ar/.test(name)))\n                                ? dom.removeAttribute(name)\n                                : dom.setAttribute(name, value)\n                        )), _skip),\n\n    diffProps = (dom, newProps, oldProps = {}, _newHTML, i) => {\n        for (i in oldProps) if (!(i in newProps)) (_newHTML = setProperty(dom, i, null, oldProps[i]))\n        for (i in newProps) if (i !== 'value' && i !== 'checked' && oldProps[i] !== newProps[i]) {\n            (_newHTML = setProperty(dom, i, newProps[i], oldProps[i]))\n        }\n        return _newHTML\n    },\n\n    Fragment = ({children, ...p}) => h('frag-', {...p, style: 'display:contents'}, children), // Fragment = props => props.children, // - this doesnt work yet\n\n    h = (t, p, ...c) => ({t, p, c: c.filter(_ => ![false, true, null].includes(_)), key: p && p.key}),\n\n    assign = (obj, props) => {\n        for (let i in props) obj[i] = props[i];\n        return (obj);\n    },\n\n    render = (vnode, dom, old = dom.v || (dom.v = {}), position, nope, _skip) =>\n\n        dom.v = vnode.pop ? vnode.map((vChild, index) => render(vChild, dom, old.c && old.c[index]))\n\n            : vnode.t.call ? (vnode.pt = render(\n                    vnode.t(\n                        //props\n                        {children: vnode.c, ...vnode.p},\n                        // state\n                        vnode.s = old.s || {},\n                        // update\n                        newState => {\n                            assign(vnode.s, newState);\n                            render(vnode, dom, vnode)\n                        }\n                    ),\n                    old.pt || dom,\n                    old && old.pt || {}\n                    ), vnode\n                )\n\n                : (\n                    vnode.d = old.d || (\n                        vnode.t\n                            ? document.createElement(vnode.t)\n                            : new Text(vnode.p)\n                    ),\n\n                    vnode.p != old.p && (\n                        vnode.t\n                            //skip diffing children if inserting html (maybe skipping isn't necessary?)\n                            ? (_skip = diffProps(vnode.d, vnode.p, old.p))\n                            : vnode.d.data = vnode.p\n                    ),\n                        // insert at position\n                    old.d && position == nope || dom.insertBefore(vnode.d, dom.childNodes[position + 1]),\n                    // _skip && console.log('skiping diff'),\n                        // diff children (typed/keyed)\n                    !_skip && (vnode.o = vnode.c.concat.call([], ...vnode.c).map((vChild, pos) =>\n\n                        render(\n                            //vdom\n                            vChild = vChild.c ? vChild : h('', vChild),\n                            //dom\n                            vnode.d,\n                            //old dom\n                            old.o && old.o.find((vnode, childPos) =>\n                            vnode && vnode.t == vChild.t && vnode.key == vChild.key\n                            && (\n                                childPos == pos && (pos = nope),\n                                    old.o[childPos] = 0,\n                                    vnode\n                            )) || {},\n                            //position\n                            pos\n                        )\n                    )),\n                        // remove stragglers\n                    old.o && old.o.map(e => e && e.d.remove()), assign(old, vnode));  //return the vnode\n\nexport {h, render, Fragment};"],"names":["eventProxy","e","__ev","type","IS_NON_DIMENSIONAL","setStyleProp","style","key","value","setProperty","test","dom","name","oldValue","_style","_useCapture","_nameLower","_newHTML","_skip","cssText","i","setStyle","replace","toLowerCase","slice","addEventListener","removeEventListener","__html","innerHTML","includes","removeAttribute","setAttribute","Fragment","children","p","h","t","c","filter","_","assign","obj","props","render","vnode","old","v","position","nope","pop","map","vChild","index","call","pt","s","newState","d","document","createElement","Text","newProps","oldProps","diffProps","data","insertBefore","childNodes","o","concat","pos","find","childPos","remove"],"mappings":"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"}