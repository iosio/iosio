{"version":3,"file":"index.js","sources":["../src/Router.js","../src/lazyLoader.js"],"sourcesContent":["import {h, Component} from \"preact\";\nimport {routing} from \"@iosio/routing\";\nimport {propsChanged, isObj, isFunc} from \"@iosio/util\";\n\nconst {routerSwitch} = routing;\nexport {routing};\n\nexport class Router extends Component {\n    constructor(props) {\n        super(props);\n        let lastPath = window.location.pathname;\n        this.unsub = routing.$onChange(() => {\n            const {pathname} = routing;\n            if (lastPath !== pathname) {\n                this.setState(Object.create(null));\n                lastPath = pathname;\n            }\n        });\n        this.initial = true;\n    }\n\n    shouldComponentUpdate(nextProps) {\n        const {next, toLast, noChange, replacedLast} = routerSwitch({\n            pathMap: nextProps.pathMap,\n            noMatch: nextProps.noMatch,\n            root: nextProps.root\n        });\n\n        this.next = props => h(next, props);\n        let {pathMap, noMatch, root} = this.props;\n        return nextProps.root !== root || nextProps.noMatch !== noMatch\n            || propsChanged(pathMap || {}, nextProps.pathMap || {})\n            || !(toLast || replacedLast || noChange)\n    }\n\n    componentDidMount() {\n        this.initial = false;\n    }\n\n    componentWillUnmount() {\n        this.unsub();\n    }\n\n    render({pathMap, noMatch, root, ...rest}) {\n        return h(\n            this.initial\n                ? routerSwitch({pathMap, noMatch, root}).next\n                : this.next,\n            rest\n        );\n    }\n}\n\nexport const anchorTagResetStylesFn = (className = '') => /*language=css*/\n    `${className} a:hover,${className} a:focus,${className} a:active,${className} a:link,${className} a:visited {color: inherit;text-decoration: none;background-color: transparent;outline: 0;-webkit-tap-highlight-color: transparent;}`;\n\nexport const anchorTagResetStyles = anchorTagResetStylesFn('');\n\nconst getSearch = (toParams) => isObj(toParams) ? routing.stringifyParams(toParams) : (toParams || '');\n\nexport class Linkage extends Component {\n\n    componentDidMount() {\n        const {listenTo, toPath, toParams} = this.props;\n        if (listenTo) {\n            let lastPath, lastSearch, lastURL, isActive = false;\n\n            let update = () => {\n                const {pathname, search} = location;\n                lastPath = pathname;\n                lastSearch = search;\n                lastURL = pathname + search;\n                this.setState({isActive});\n            };\n\n            const check = () => {\n                const {pathname, search} = location;\n                isActive = false;\n                if (listenTo === 'pathname' && (lastPath !== pathname)) {\n                    if (toPath === pathname) isActive = true;\n                    update();\n                } else if (listenTo === 'search' && (lastSearch !== search)) {\n                    if (getSearch(toParams) === search) isActive = true;\n                    update();\n                } else if (listenTo === 'url') {\n                    if ((toPath + getSearch(toParams)) === (pathname + search)) isActive = true;\n                    update();\n                }\n            };\n\n            this.unsub = routing.$onChange(check);\n            check();\n            lastPath = location.pathname;\n            lastSearch = location.pathname;\n            lastURL = lastPath + lastSearch;\n        }\n    }\n\n    componentWillUnmount() {\n        this.unsub && this.unsub();\n    }\n\n    render({element, listenTo, children, href, toPath = location.pathname, toParams, onClick, ...rest}, {isActive}) {\n\n        const _href = element ? {}\n            : {href: href || toPath + getSearch(toParams)};\n\n        const linkProps = {\n            ..._href,\n            onClick: (e) => {\n                if (toPath) {\n                    if (e.stopImmediatePropagation) e.stopImmediatePropagation();\n                    if (e.stopPropagation) e.stopPropagation();\n                    e.preventDefault();\n                    routing.route(toPath, toParams);\n\n                }\n                onClick && onClick();\n            },\n            ...rest\n        };\n\n        return h(element || 'a', linkProps, isFunc(children) ? children({...routing, isActive}) : children)\n    }\n}\n\n\n\n","import {h} from \"preact\";\nimport {Suspense, lazy} from \"preact/compat\";\n\nexport const lazyLoader = (importComponent, indicator) => {\n    const SomeComponent = lazy(importComponent);\n    const Placeholder = () => h('div');\n    const Loader = indicator || Placeholder;\n\n    function LazyComponent(props) {\n        return (\n            h(Suspense, {fallback: h(Loader)},\n                h(SomeComponent, {...props})\n            )\n        )\n    }\n\n    // Lazy\n    return LazyComponent;\n};\n"],"names":["routerSwitch","routing","Router","Component","constructor","props","super","lastPath","window","location","pathname","this","unsub","$onChange","setState","Object","create","initial","shouldComponentUpdate","nextProps","next","toLast","noChange","replacedLast","pathMap","noMatch","root","h","propsChanged","componentDidMount","componentWillUnmount","render","rest","anchorTagResetStylesFn","className","anchorTagResetStyles","getSearch","toParams","isObj","stringifyParams","Linkage","listenTo","toPath","lastSearch","isActive","update","search","check","element","children","href","onClick","linkProps","e","stopImmediatePropagation","stopPropagation","preventDefault","route","isFunc","lazyLoader","importComponent","indicator","SomeComponent","lazy","Loader","Suspense","fallback"],"mappings":"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"}