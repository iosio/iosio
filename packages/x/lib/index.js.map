{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["let isFunc = f => typeof f === 'function',\n\n    eventProxy = function (e) {\n        return this.__ev[e.type](e);\n    },\n\n    IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,\n\n    setStyleProp = (style, key, value) => key[0] === '-' ? style.setProperty(key, value)\n        : (style[key] = typeof value === 'number'\n        && IS_NON_DIMENSIONAL.test(key) === false ? value + 'px' : value == null ? '' : value),\n\n    setStyle = (dom, value, oldValue, _style = dom.style) => {\n        if (typeof value === 'string') return _style.cssText = value;\n        typeof oldValue === 'string' && (_style.cssText = '', oldValue = null);\n        if (oldValue) for (let i in oldValue) if (!(value && i in value)) setStyleProp(_style, i, '');\n        if (value) for (let i in value) if (!oldValue || value[i] !== oldValue[i]) setStyleProp(_style, i, value[i]);\n    },\n    //preact-ish set property. not supporting SVG\n    setProperty = (dom, name, value, oldValue, _style, _useCapture, _nameLower, _newHTML, _skip) =>\n        ((name === 'style' ? setStyle(dom, value, oldValue)\n            : name[0] === 'o' && name[1] === 'n'\n                ? (_useCapture = name !== (name = name.replace(/Capture$/, '')),\n                    _nameLower = name.toLowerCase(),\n                    name = (_nameLower in dom ? _nameLower : name).slice(2),\n                    value ? (!oldValue && dom.addEventListener(name, eventProxy, _useCapture),\n                            (dom.__ev || (dom.__ev = {}))[name] = value\n                    ) : dom.removeEventListener(name, eventProxy, _useCapture))\n                : (name === 'dangerouslySetInnerHTML' && (value || oldValue))\n                    ? ((!value || !oldValue || value.__html != oldValue.__html)\n                    && (dom.innerHTML = (value && value.__html) || ''), _skip = true) //skip diff children\n                    : (!(['list', 'tagName', 'form', 'type', 'size'].includes(name)) && name in dom)\n                        ? dom[name] = value === null ? '' : value\n                        : name === 'ref' && isFunc(value)\n                            ? value(dom) : !isFunc(value) && (\n                            (value === null || (value === false && !/^ar/.test(name)))\n                                ? dom.removeAttribute(name)\n                                : dom.setAttribute(name, value)\n                        )), _skip),\n\n    diffProps = (dom, newProps, oldProps = {}, _newHTML) => {\n\n        for (let name in oldProps) {\n            if (!(name in newProps)) {\n                setProperty(dom, name, null, oldProps[name]) && (_newHTML = true)\n            }\n        }\n        for (let name in newProps) {\n            if (oldProps[name] !== newProps[name]) {\n                setProperty(dom, name, newProps[name], oldProps[name]) && (_newHTML = true)\n            }\n        }\n        return _newHTML\n    },\n\n    h = (t, p, ...c) => ({t, p, c: c.filter(_ => ![false, true, null, undefined].includes(_)), key: p && p.key}),\n\n    assign = (obj, props) => {\n        for (let i in props) obj[i] = props[i];\n        return (obj);\n    },\n\n    remove = (v) => v.d ? v.d.remove() : v.patched && remove(v.patched),\n\n    render = (vnode, dom, old = dom.v || (dom.v = {}), position, nope, _skip) =>\n\n        dom.v = vnode.pop ? vnode.map((vChild, index) => render(vChild, dom, old.c && old.c[index]))\n\n            : vnode.t.call ?\n                (vnode.patched = render(\n                    vnode.t(\n                        //props\n                        {children: vnode.c, ...vnode.p},\n                        // state\n                        vnode.s = old.s || {},\n                        // update\n                        newState => {\n                            assign(vnode.s, newState);\n                            render(vnode, dom, vnode)\n                        },\n                    ),\n                    old.patched || dom,\n                    old && old.patched || {}\n                ), vnode)\n\n                : (vnode.d = old.d || (vnode.t ? document.createElement(vnode.t) : new Text(vnode.p)),\n\n                    vnode.p != old.p && (\n                        vnode.t\n                            //skip diffing children if inserting html (maybe skipping isn't necessary?)\n                            ? (_skip = diffProps(vnode.d, vnode.p, old.p))\n                            : vnode.d.data = vnode.p\n                    ),\n                        // insert at position\n                    old.d && position == nope || dom.insertBefore(vnode.d, dom.childNodes[position + 1]),\n                        // _skip && console.log('skiping diff'),\n                        // diff children (typed/keyed)\n                    !_skip && (vnode.o = [].concat(...vnode.c).map((vChild, pos) =>\n                            render(\n                                //vdom\n                                vChild = vChild.c ? vChild : h('', vChild),\n                                //dom\n                                vnode.d,\n                                //old dom\n                                old.o && old.o.find((vnode, childPos) =>\n\n                                vnode && vnode.t == vChild.t && vnode.key == vChild.key\n                                && (\n                                    childPos == pos && (pos = nope),\n                                        old.o[childPos] = 0,\n                                        vnode\n                                )) || {},\n                                //position\n                                pos\n                            )\n                        )\n                    ),\n                        // remove stragglers\n                    old.o && old.o.map(e => e && remove(e)), assign(old, vnode)//return the vnode\n                ),\n\n    // for subscriptions handling\n    Host = ({children, ...props}) => h('x-host', props, children),\n\n    // Fragment = props => props.children, // - this doesnt work yet,\n    // using custom element with display:contents to keep familiar api until fragments work\n    Fragment = ({children, ...props}) => h('x-frag', props, children),\n\n    define = tag =>\n        customElements.define(tag, class extends HTMLElement {\n            constructor() {\n                super();\n                this.attachShadow({mode: 'open'}).innerHTML = `\\\n            <style>:host{display:contents}</style> <slot> </slot>\n            `;\n            }\n\n            disconnectedCallback() {\n                if (this.isConnected) return;\n                (this._s || []).forEach(s => isFunc(s) && s());\n            }\n\n            connectedCallback() {\n                if (this.mtd) return;\n                this.mtd = 1;\n                isFunc(this._c) && (this._s = [].concat(this._c()));\n            }\n\n            set lifeCycle(fn) {\n                this._c = fn;\n            }\n        });\n\ndefine('x-host');\n\ndefine('x-frag');\n\nexport {h, render, Fragment, Host}"],"names":["isFunc","f","eventProxy","e","__ev","type","IS_NON_DIMENSIONAL","setStyleProp","style","key","value","setProperty","test","dom","name","oldValue","_style","_useCapture","_nameLower","_newHTML","_skip","cssText","i","setStyle","replace","toLowerCase","slice","addEventListener","removeEventListener","__html","innerHTML","includes","removeAttribute","setAttribute","h","t","p","c","filter","_","undefined","assign","obj","props","remove","v","d","patched","render","vnode","old","position","nope","pop","map","vChild","index","call","children","s","newState","document","createElement","Text","newProps","oldProps","diffProps","data","insertBefore","childNodes","o","concat","pos","find","childPos","Host","Fragment","define","tag","customElements","HTMLElement","constructor","super","this","attachShadow","mode","disconnectedCallback","isConnected","_s","forEach","connectedCallback","mtd","_c","lifeCycle","fn"],"mappings":"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"}