import{isString as t,eventListener as e,isObj as s,isArray as n,isFunc as o}from"@iosio/util";export{eventListener}from"@iosio/util";import{obi as i}from"@iosio/obi";import{render as r}from"@iosio/xact";const a=({type:e,tag:s,value:n,attrs:o={},props:i={},children:r=[]})=>{let c="fragment"===e?document.createDocumentFragment():"text"===e?document.createTextNode(n):document.createElement(s);for(let t in o)c.setAttribute(t,o[t]);for(let a in i)"ref"===a?i[a](c):"style"===a&&t(a)?c.style.cssText=i[a]:c[a]=i[a];return r.forEach(t=>c.appendChild(a(t))),c},c=(t,e)=>{let s=document.createElement("style");return t&&(s.id=t),s.appendChild(document.createTextNode("")),(e||document.head).appendChild(s),t=>(s.appendChild(document.createTextNode(t)),s)},h=t=>{for(;t.parentNode&&(t=t.parentNode);)if(t instanceof ShadowRoot)return t;return document},d=t=>{let e=document.createElement("style");return e.appendChild(document.createTextNode(t)),{element:e,update:t=>e.textContent=t}},l=t=>{let e=document.createElement("template");return e.innerHTML=t,e},p=(t,e)=>{let s=l(e);t.innerHTML="",t.appendChild(s.content.cloneNode(!0))},u=()=>{const t={};return(e,s)=>(t[e]||(t[e]=l(s)),t[e].content.cloneNode(!0))},b=(...t)=>e=>t.reduce((t,e)=>e(t),e),m=(t,e,s)=>t[s?"setAttribute":"removeAttribute"](e,"");class C extends HTMLElement{constructor(){super();const{shadow:t}=this.constructor;t&&this.attachShadow({mode:"open"}),this.unsubs=[],this.eventListener=(t,s,n,o)=>this.unsubs.push(e(t,s,n,o)),this.emit=(t,e,s={},n=this)=>n.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,composed:!0,...s})),this.unsubSubs=()=>{this.unsubs.forEach(t=>t&&t())}}disconnectedCallback(){this.isConnected||(this.willUnmount&&this.willUnmount(),this.unsubs.length&&this.unsubSubs())}}const g="adoptedStyleSheets"in document,f=new Map,y=new Map,S=t=>class extends t{constructor(){super(),this._adoptify=()=>((t,e,s={})=>{const{async:n,useStyleTag:o,noDefaultResets:i}=s;e=(t.shadowRoot&&!i?":host, *, *::before, *::after {box-sizing: border-box;} ":"")+(e||s.cssString||"");const r=t.constructor.tag||t.constructor;if(g&&!o){let s=t.shadowRoot||h(t),o=f.get(r);o||(o=new CSSStyleSheet,o[n?"replace":"replaceSync"](e),f.set(r,o)),[].concat(s.adoptedStyleSheets).includes(o)||(s.adoptedStyleSheets=[...s.adoptedStyleSheets,o])}else{let s=y.get(r);s||(s=d(e).element,y.set(r,s)),(t.shadowRoot||t).appendChild(s.cloneNode(!0))}})(this,this.constructor.styles,this.constructor.adoptableStyles),this.shadowRoot&&this._adoptify()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),!this.shadowRoot&&this._adoptify()}},x=t=>t.__reactivePropsMixin&&t.__proxyRefsMixin?class extends t{initialUpdate(){if(this.propLogic){const t=this.propLogic(!0);Object.keys(this.props).forEach(e=>{t[e]&&t[e](this.props[e],this.refs)})}}subsequentUpdate(){if(this.propLogic){const t=this.propLogic();this.changedProps.forEach(e=>t[e]&&t[e](this.props[e],this.refs))}}}:(console.error("propLogic requires both reactiveProps and proxyRefs mixins"),t),v=t=>{class e extends t{constructor(){super();const t=this.constructor.proxyRefs||{},e=t.selectMethod||"querySelector",s=t.selectorPrepend||"#",n=t.selectorAppend||"";let o={};const i=this.shadowRoot||this;this.refs=new Proxy({},{get:(t,r)=>"refreshRefsCache"===r?()=>o={}:(o[r]||(o[r]=i[e](s+r+n)),o[r])})}}return e.__proxyRefsMixin=!0,e},w=Symbol(),k=t=>{class e extends t{constructor(){super();const{initAttrs:t}=this.constructor;this.prevProps={},this.props={},this.changedProps=[],this.hasMounted=!1,this.mounted=new Promise(t=>this._mount=t);let e=t.length;for(;e--;)t[e](this);this.update()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this.hasMounted||this._mount()}update(){return this.processing||(this.processing=this.mounted.then(t=>{this.hasMounted?this._subsequentUpdate():this._initialUpdate(),this.changedProps=[],this.processing=!1})),this.processing}beforeInitialUpdate(){}_initialUpdate(){this.beforeInitialUpdate(this.props,this.prevProps,this.changedProps),this.initialUpdate(),this.didMount&&this.didMount(this.props,this.prevProps,this.changedProps),this.hasMounted=!0}initialUpdate(){}shouldUpdate(t,e,s){}_subsequentUpdate(){const t=this.shouldUpdate(this.props,this.prevProps,this.changedProps);(t||void 0===t)&&(this.subsequentUpdate(),this.didUpdate&&this.didUpdate(this.props,this.prevProps,this.changedProps))}subsequentUpdate(){}attributeChangedCallback(t,e,s){super.attributeChangedCallback&&super.attributeChangedCallback(t,e,s),this[w]!==t&&e!==s&&(this[(t=>t.replace(/-(\w)/g,(t,e)=>e.toUpperCase()))(t)]=s)}disconnectedCallback(){this.isConnected||this.willUnmount&&this.willUnmount()}static get observedAttributes(){let{prototype:t,propTypes:e}=this;return this.initAttrs=[],e?Object.keys(e).map(o=>{let i=(t=>t.replace(/([A-Z])/g,"-$1").toLowerCase())(o),r=e[o].name?{type:e[o]}:e[o];return o in t||Object.defineProperty(t,o,{get(){return this.props[o]},set(t){let{value:e,error:a}=((t,e)=>((e=e||String)==Boolean?t=[!0,1,"","1","true"].includes(t):"string"==typeof t&&(t=e==Number?Number(t):e==Object||e==Array?JSON.parse(t):t),"any"===e?{value:t,error:!1}:{}.toString.call(t)==`[object ${e.name}]`?{value:t,error:e==Number&&Number.isNaN(t)}:{value:t,error:!0}))(t,r.type);a&&null!=e&&console.error(`[${o}] must be type [${r.type.name}]`),e!==this.props[o]&&(this.changedProps.push(o),r.reflect&&this.mounted.then(()=>{this[w]=i,((t,e,o)=>{var i,r;null===o||!1===o||"null"===o||"false"===o?t.removeAttribute(e):t.setAttribute(e,(i=t).getAttribute&&i.localName&&(r=i.getAttribute("is"),i.localName.includes("-")||r&&r.includes("-"))&&(s(o)||n(o))?JSON.stringify(o):o)})(this,i,r.type!==Boolean||e?e:null),this[w]=!1}),this.prevProps[o]=this.props[o],this.props[o]=e,this.update())}}),r.value&&this.initAttrs.push(t=>t[o]=r.value),i}):[]}}return e.__reactivePropsMixin=!0,e},_=t=>class extends t{connectedCallback(){if(super.connectedCallback&&super.connectedCallback(),s(this.state)){this.state=i(this.state);const t=o(this.onStateChange)?this.onStateChange:()=>{this.stateChanged=!0,this.update&&this.update().then(()=>this.stateChanged=!1)};this.__unsubStateChange=this.state.$onChange(t)}}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this.isConnected||this.__unsubStateChange&&this.__unsubStateChange()}},P=new Map,U=t=>class extends t{constructor(){super();const t=this.constructor.template;this._templify=()=>t&&((t,e)=>{if(!t||!e)return;let s=t.shadowRoot||t,n=t.constructor,o=P.get(n);o||(o=document.createElement("template"),o.innerHTML=e,P.set(n,o)),s.appendChild(o.content.cloneNode(!0))})(this,t),this.shadowRoot&&this._templify()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),!this.shadowRoot&&this._templify()}},M=t=>class extends t{constructor(){let t;super(),this.updateStyles=()=>{if(this.updatableStyles){let e=this.updatableStyles(this.props,this.prevProps);if(!e)return;t?t.update(e):(t=d(e),(this.shadowRoot||this).appendChild(t.element))}}}},E=t=>class extends t{constructor(){super(),this.unsubs=[],this.eventListener=(t,s,n,o)=>this.unsubs.push(e(t,s,n,o)),this.emit=(t,e,s={},n=this)=>n.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,composed:!0,...s})),this.unsubSubs=()=>{this.unsubs.forEach(t=>t&&t())}}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this.isConnected||this.unsubs.length&&this.unsubSubs()}},N=b(k,_,S,U,M,v,x,E)(class extends HTMLElement{constructor(){super();const{shadow:t}=this.constructor;t&&this.attachShadow({mode:"open"})}});N.define=(...t)=>{t.forEach(t=>{if(!t.tag)return console.error('The Elemental base class requires a tag name on the static "tag" property',t);customElements.define(t.tag,t)})};class R extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}}const L=t=>t.__reactivePropsMixin?class extends t{renderer(){this.render&&r(this.render(this.props,this.state),this.shadowRoot||this)}initialUpdate(){this.renderer()}subsequentUpdate(){this.renderer()}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this.isConnected||this.render&&r(null,this.shadowRoot||this)}}:(console.error("vdom requires reactiveProps mixin"),t);export{C as BaseElement,N as Elemental,R as ShadowElement,u as TemplateMapFactory,S as adoptableStyles,m as booleanAttr,b as compose,a as createDom,d as createStyleTag,E as events,h as getShadowParent,c as headStyleTag,x as propLogic,v as proxyRefs,k as reactiveProps,_ as reactiveState,U as staticTemplate,p as templateToHost,M as updatableStyles,L as vdom};
//# sourceMappingURL=index.js.map
