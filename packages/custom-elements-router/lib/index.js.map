{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {extend} from \"@iosio/util\";\nimport {routing} from \"@iosio/routing\";\n\nexport {routing};\n\nexport const CustomElementsRouter = ({transition, pathMap, noMatch, loadingIndicator, lazyMap}) => {\n\n    transition = typeof transition === 'number'\n        ? transition : transition === true ? 150 : 0;\n\n    var initial = true, elem, getMountPoint, timeout,\n        unsub, transitionStyle = `opacity ${transition}ms ease-in-out`,\n        {routerSwitch} = routing, CE = customElements,\n\n        clearMountingPoint = (e) => {\n            let child = e.lastElementChild;\n            while (child) (e.removeChild(child), child = e.lastElementChild)\n        },\n\n        m = (parentNode, elem) => (clearMountingPoint(parentNode), parentNode.appendChild(elem)),\n\n        mount = (elementName, parentNode) => {\n            clearTimeout(timeout);\n            elem = document.createElement(elementName);\n            if (initial || !transition) return m(parentNode, elem);\n            extend(parentNode.style, {transition: transitionStyle, opacity: 0});\n            timeout = setTimeout(() => {\n                m(parentNode, elem);\n                extend(parentNode.style, {transition: transitionStyle, opacity: 1})\n            }, transition ? transition + 10 : 0);\n        },\n\n        mountLazy = (elementName, to) => {\n            loadingIndicator && mount(loadingIndicator, to);\n            lazyMap && lazyMap[elementName] && lazyMap[elementName]().then(() =>\n                CE.whenDefined(elementName).then(() =>\n                    // in case of slow network and the user decides to locate somewhere else before\n                    // the request has finished, check that the pathMap matches the element name before exec the mount\n                    // so that the previously requested element doesn't mount over the current\n                    pathMap[location.pathname] === elementName && mount(elementName, to)\n                ));\n        },\n\n        doRoute = () => {\n            let {next, toLast, noChange, replacedLast} = routerSwitch({pathMap, noMatch}),\n\n                parentNode = getMountPoint && getMountPoint();\n\n            if (!(parentNode && parentNode.nodeName) || toLast || replacedLast || (noChange && !initial)) return;\n\n            next && CE.get(next) ? mount(next, parentNode) : mountLazy(next, parentNode);\n        };\n\n    return {\n        mountTo: getNodeToMountToFunction => {\n            unsub && unsub(); // you didn't follow directions!!!\n            getMountPoint = getNodeToMountToFunction;\n            doRoute();\n            initial = false;\n            unsub = routing.$onChange(doRoute);\n            return unsub;\n        }\n    }\n};\n"],"names":["CustomElementsRouter","transition","pathMap","noMatch","loadingIndicator","lazyMap","elem","getMountPoint","timeout","unsub","initial","transitionStyle","routerSwitch","routing","CE","customElements","m","parentNode","e","child","lastElementChild","removeChild","clearMountingPoint","appendChild","mount","elementName","clearTimeout","document","createElement","extend","style","opacity","setTimeout","doRoute","next","toLast","noChange","replacedLast","to","nodeName","get","then","whenDefined","location","pathname","mountTo","getNodeToMountToFunction","$onChange"],"mappings":"kHAKaA,MAAAA,EAAuB,EAAEC,WAAAA,EAAYC,QAAAA,EAASC,QAAAA,EAASC,iBAAAA,EAAkBC,QAAAA,MAKlF,IAAoBC,EAAMC,EAAeC,EACrCC,EADAC,GAAU,EACHC,EAAmB,WAJ9BV,EAAmC,iBAAfA,EACdA,GAA4B,IAAfA,EAAsB,IAAM,mBAI3CW,aAACA,GAAgBC,EAASC,EAAKC,eAO/BC,EAAI,CAACC,EAAYX,KALKY,CAAAA,IAClB,IAAIC,EAAQD,EAAEE,iBACd,KAAOD,GAAQD,EAAEG,YAAYF,GAAQA,EAAQD,EAAEE,kBAGxBE,CAAmBL,GAAaA,EAAWM,YAAYjB,IAElFkB,EAAQ,CAACC,EAAaR,KAGlB,GAFAS,aAAalB,GACbF,EAAOqB,SAASC,cAAcH,GAC1Bf,IAAYT,EAAY,OAAOe,EAAEC,EAAYX,GACjDuB,EAAOZ,EAAWa,MAAO,CAAC7B,WAAYU,EAAiBoB,QAAS,IAChEvB,EAAUwB,WAAW,KACjBhB,EAAEC,EAAYX,GACduB,EAAOZ,EAAWa,MAAO,CAAC7B,WAAYU,EAAiBoB,QAAS,KACjE9B,EAAaA,EAAa,GAAK,IActCgC,EAAU,KACN,IAAIC,KAACA,EAADC,OAAOA,EAAPC,SAAeA,EAAfC,aAAyBA,GAAgBzB,EAAa,CAACV,QAAAA,EAASC,QAAAA,IAEhEc,EAAaV,GAAiBA,IAd1B,IAACkB,EAAaa,GAgBhBrB,IAAcA,EAAWsB,UAAaJ,GAAUE,GAAiBD,IAAa1B,IAEpFwB,GAAQpB,EAAG0B,IAAIN,GAAQV,EAAMU,EAAMjB,IAlB1BQ,EAkBkDS,EAlBrCI,EAkB2CrB,EAjBjEb,GAAoBoB,EAAMpB,EAAkBkC,GAC5CjC,GAAWA,EAAQoB,IAAgBpB,EAAQoB,KAAegB,KAAK,IAC3D3B,EAAG4B,YAAYjB,GAAagB,KAAK,IAI7BvC,EAAQyC,SAASC,YAAcnB,GAAeD,EAAMC,EAAaa,QAcjF,MAAO,CACHO,QAASC,IACLrC,GAASA,IACTF,EAAgBuC,EAChBb,IACAvB,GAAU,EACVD,EAAQI,EAAQkC,UAAUd"}