{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/**/\n/*\n\nhttps://gist.github.com/developit/2038b141b31287faa663f410b6649a87\n\n\nexport const h=(t,p,...c)=>({t,p,c,k:p&&p.key})\n\nexport const render=(e,d,t=d.t||(d.t={}),p,r,c)=>\n  // arrays\n  e.pop?e.map((e,p)=>render(e,d,t.o&&t.o[p])):\n  // components\n  e.t.call?(e.i=render((render.c=e).t({children:e.c,...e.p},e.s=t.s||{},t=>\n    render(Object.assign(e.s,t)&&e,d,e)),t.i||d,t&&t.i||{}),e):(\n  // create notes\n  e.d=t.d||(e.t?document.createElement(e.t):new Text(e.p)),\n  // diff props\n  e.p!=t.p&&(e.t?Object.keys(e.p||{}).map(d=>\n    (c=e.p[d])!=(t.p&&t.p[d])&&(d in e.d?e.d[d]=c:e.d.setAttribute(d,c))):e.d.data=e.p),\n  // insert at position\n  t.d&&p==r||d.insertBefore(e.d,d.childNodes[p+1]),\n  // diff children (typed/keyed)\n  e.o=e.c.concat.apply([],e.c).map((d,p)=>render(d=d.c?d:h('',d),e.d,\n    t.o&&t.o.find((e,c)=>e&&e.t==d.t&&e.k==d.k&&(c==p&&(p=r),t.o[c]=0,e))||{},p)),\n  // remove stragglers\n  t.o&&t.o.map(e=>e&&e.d.remove()),Object.assign(t,e)\n)\n\n */\n\n\nlet isFunc = f => typeof f === 'function',\n\n\n    eventProxy = function (e) {\n\n        return this.__ev[e.type](e);\n    },\n\n\n    setStyleProp = (style, key, value) =>\n\n        key[0] === '-'\n\n            ? style.setProperty(key, value)\n\n            : (\n                style[key] = typeof value === 'number'\n\n                && /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i.test(key) === false\n\n                    ? value + 'px'\n                    : value == null ? '' : value\n            ),\n\n\n    setStyle = (dom, value, oldValue, _style = dom.style) => {\n\n        if (typeof value === 'string') return _style.cssText = value;\n\n        typeof oldValue === 'string' && (_style.cssText = '', oldValue = null);\n\n        if (oldValue) for (let i in oldValue) if (!(value && i in value)) setStyleProp(_style, i, '');\n\n        if (value) for (let i in value) if (!oldValue || value[i] !== oldValue[i]) setStyleProp(_style, i, value[i]);\n\n    },\n\n\n    //preact-ish set property. not supporting SVG\n    setProperty = (dom, name, value, oldValue, _style, _useCapture, _nameLower, _newHTML, _skip) =>\n        ((\n                // if style\n                name === 'style' ? setStyle(dom, value, oldValue)\n\n                    // if event\n                    : name[0] === 'o' && name[1] === 'n' ? (\n\n                        _useCapture = name !== (name = name.replace(/Capture$/, '')),\n\n                            _nameLower = name.toLowerCase(),\n\n                            name = (_nameLower in dom ? _nameLower : name).slice(2),\n\n                            value ? (\n\n                                !oldValue && dom.addEventListener(name, eventProxy, _useCapture),\n\n                                    (dom.__ev || (dom.__ev = {}))[name] = value\n\n                            ) : dom.removeEventListener(name, eventProxy, _useCapture)\n                    )\n                    // if html\n                    : name === 'dangerouslySetInnerHTML' && (value || oldValue) ? (\n\n                            (!value || !oldValue || value.__html != oldValue.__html)\n\n                            && (dom.innerHTML = (value && value.__html) || ''),\n\n                                _skip = true /*skip diff children*/\n                        )\n\n                        // if dom has property\n                        : (!(['list', 'tagName', 'form', 'type', 'size'].includes(name)) && name in dom)\n                            ? dom[name] = value === null ? '' : value\n\n                            // if ref\n                            : name === 'ref' && isFunc(value) ? value(dom)\n\n                                // if not function update attribute\n                                : !isFunc(value) && (\n\n                                value === null || (value === false && !/^ar/.test(name))\n\n                                    ? dom.removeAttribute(name) : dom.setAttribute(name, value)\n                            )\n            ), _skip\n        ),\n\n\n    diffProps = (dom, newProps, oldProps = {}, _newHTML) => {\n\n        for (let name in oldProps) if (!(name in newProps)) {\n\n            setProperty(dom, name, null, oldProps[name]) && (_newHTML = true)\n        }\n\n        for (let name in newProps) if (oldProps[name] !== newProps[name]) {\n\n            setProperty(dom, name, newProps[name], oldProps[name]) && (_newHTML = true)\n        }\n\n        return _newHTML\n    },\n\n\n    h = (t, p, ...c) => ({t, p, c: c.filter(_ => ![false, true, null, undefined].includes(_)), key: p && p.key}),\n\n\n    assign = (obj, props) => {\n        for (let i in props) obj[i] = props[i];\n        return (obj);\n    },\n\n    remove = (v) => v.d ? v.d.remove() : v.patched && remove(v.patched),\n\n\n    render = (vnode, dom, old = dom.v || (dom.v = {}), position, _undefined, _skip) =>\n\n        dom.v = vnode.pop ? vnode.map((vChild, index) => render(vChild, dom, old.c && old.c[index]))\n\n\n            : vnode.t.call ? (\n\n                    vnode.patched = render(\n                        vnode.t(\n                            //props\n                            {children: vnode.c, ...vnode.p},\n                            // state\n                            vnode.s = old.s || {},\n                            // update\n                            newState => {\n                                assign(vnode.s, newState);\n                                render(vnode, dom, vnode)\n                            },\n                        ),\n\n                        old.patched || dom,\n\n                        old && old.patched || {}\n                    ), vnode\n                )\n\n                : (\n                    //assign old dom to new dom\n                    vnode.d = old.d || ( // but if falsy then create the node\n                        vnode.t ? document.createElement(vnode.t) : new Text(vnode.p)\n                    ),\n\n                        // if new props then update them them\n                    vnode.p != old.p && (\n\n                        vnode.t\n                            // if it has a type then diff them\n                            // diffProps will return true if we inserted innerHTML and want to skip diffing children\n                            ? (_skip = diffProps(vnode.d, vnode.p, old.p))\n\n                            : vnode.d.data = vnode.p\n                    ),\n                        // insert at position\n                    old.d && position == _undefined || dom.insertBefore(vnode.d, dom.childNodes[position + 1]),\n\n\n                        // diff children (typed/keyed) // _skip && console.log('skiping diff'),\n                    !_skip && (vnode.o = [].concat(...vnode.c).map((vChild, pos) =>\n                            render(\n                                //vdom\n                                vChild = vChild.c ? vChild : h('', vChild),\n                                //dom\n                                vnode.d,\n                                //old dom\n                                old.o && old.o.find((vnode, childPos) =>\n\n                                vnode && vnode.t == vChild.t && vnode.key == vChild.key\n                                && (\n                                    childPos == pos && (pos = _undefined),\n                                        old.o[childPos] = 0,\n                                        vnode\n                                )) || {},\n                                //position\n                                pos\n                            )\n                        )\n                    ),\n                        // remove stragglers\n                    old.o && old.o.map(e => e && remove(e)), assign(old, vnode)//return the vnode\n                ),\n\n\n    // for subscriptions handling\n    Host = ({children, ...props}) => h('z-host', props, children),\n\n\n    // Fragment = props => props.children, // - this doesnt fully work yet,\n    // using custom element with display:contents to keep familiar api until fragments work\n    Fragment = ({children, ...props}) => h('z-fragment', props, children),\n\n\n    define = (tag, elem) => customElements.define(tag, elem);\n\n\nclass Frag extends HTMLElement {\n    constructor() {\n        super(), this.attachShadow({mode: 'open'}).innerHTML = `<style>:host{display:contents}</style><slot></slot>`\n    }\n}\n\n\ndefine('z-fragment', Frag);\n\n\ndefine('z-host', class extends Frag {\n    disconnectedCallback() {\n        let {isConnected: c, s} = this;\n        !c && s && s.map(u => isFunc(u) && u())\n    }\n\n    connectedCallback(f) {\n        this.m || (this.m = 1, isFunc((f = this.f)) && (this.s = [].concat(f())))\n    }\n\n    set lifeCycle(fn) {\n        this.f = fn\n    }\n});\n\n\nexport {h, render, Fragment, Host}"],"names":["isFunc","f","eventProxy","e","__ev","type","setStyleProp","style","key","value","setProperty","test","dom","name","oldValue","_style","_useCapture","_nameLower","_newHTML","_skip","cssText","i","setStyle","replace","toLowerCase","slice","addEventListener","removeEventListener","__html","innerHTML","includes","removeAttribute","setAttribute","h","t","p","c","filter","_","undefined","assign","obj","props","remove","v","d","patched","render","vnode","old","position","_undefined","pop","map","vChild","index","call","children","s","newState","document","createElement","Text","newProps","oldProps","diffProps","data","insertBefore","childNodes","o","concat","pos","find","childPos","Host","Fragment","define","tag","elem","customElements","Frag","HTMLElement","constructor","super","this","attachShadow","mode","disconnectedCallback","isConnected","u","connectedCallback","m","lifeCycle","fn"],"mappings":"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"}