{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {obi} from \"@iosio/obi\";\nimport {eventListener, isObj} from \"@iosio/util\";\nimport {h, render, Fragment, Host} from \"@iosio/x\";\n\nexport {h, render, Fragment, Host};\n\nexport class Elemental extends HTMLElement {\n    constructor(props) {\n        super(props);\n        const {shadow, styles, template, proxyRefs} = this.constructor;\n        shadow && this.attachShadow({mode: 'open'});\n        if (isObj(styles) && styles.global && !globalStyleTagCache.get(this.constructor)) {\n            headStyleTag()(styles.global);\n            globalStyleTagCache.set(this.constructor, true);\n        }\n        let initial = true, adoptSheets = (cssStrOrObj) => {\n            let {options = {}, css = ''} = isObj(cssStrOrObj) ? cssStrOrObj : {css: cssStrOrObj};\n            this.fallbackCssString = adoptStyles(this, css, {\n                getStringOnFallback: false,//!!this.render,\n                ...options\n            })\n        }, statics = () => {\n            styles && adoptSheets(styles);\n            template && appendTemplate(this, template);\n        };\n\n        Object.assign(this, {\n            unsubs: [],\n            refs: proxyRefs ? refs(proxyRefs)(this) : {},\n            props: {},\n            prevProps: {},\n            changedProps: [],\n            mounted: new Promise(mount => (this.mount = mount)),\n            initialized: new Promise(mount => (this.init = mount)),\n            update: () => {\n                if (!this.processing) {\n                    this.processing = this.mounted.then(_ => {\n                        this.render && this.renderer && this.renderer();\n                        if (initial) {\n                            this.unmount = this.didMount(...this[GET_ARGS]()) || NOOP;\n                            const logic = this.propLogic && this.propLogic(true);\n                            logic && Object.keys(this.props).forEach(prop => {\n                                logic[prop] && logic[prop](this.props[prop], this.refs);\n                            });\n                        } else {\n                            const shouldUpdate = this.shouldUpdate(...this[GET_ARGS]());\n                            if (shouldUpdate || shouldUpdate === undefined) {\n                                this.didUpdate(...this[GET_ARGS]());\n                                const logic = this.propLogic && this.propLogic();\n                                logic && this.changedProps.forEach(prop =>\n                                    logic[prop] && logic[prop](this.props[prop], this.refs)\n                                )\n                            }\n                        }\n                        initial = false;\n                        this.changedProps = [];\n                        this.processing = false;\n                    })\n                }\n                return this.processing;\n            }\n        });\n\n        shadow && statics();\n        this.initialized.then(() => {\n            !shadow && statics();\n            if (this.state) {\n                this.unsubs.push((this.state = obi(this.state)).$onChange((s, paths) =>\n                    defer(() => this.onStateChange(s, paths))\n                ));\n            }\n            if (this.observe) {\n                [].concat(this.observe).forEach(o => {\n                    isObj(o) && o.$onChange && this.unsubs.push(o.$onChange(this.update));\n                })\n            }\n            this.beforeInitialUpdate(...this[GET_ARGS]());\n            this.mount();\n        });\n\n        let initAttrs = this.constructor[INIT_ATTRS], length = initAttrs.length;\n        while (length--) initAttrs[length](this);\n        this.update();\n\n    };\n\n    [GET_ARGS] = () => [this.props, this.prevProps, this.changedProps];\n\n    emit = (event, detail, opts = {}, from = this) => from.dispatchEvent(\n        new CustomEvent(event, {detail: detail, bubbles: true, composed: true, ...opts})\n    );\n\n    eventListener = (to, ev, cb, opts) => this.unsubs.push(eventListener(to, ev, cb, opts));\n\n    renderer = () => {\n        render(this.render(this.props, this.state, this), this.shadowRoot || this);\n    };\n\n    connectedCallback() {\n        if (this[IS_MOUNTED]) return;\n        this[IS_MOUNTED] = true;\n        this.init();\n    }\n\n    attributeChangedCallback(a, o, n) {\n        if (this[IGNORE_ATTR] === a || o === n) return;\n        this[attrToProp(a)] = n;\n    }\n\n    static get observedAttributes() {\n        let {prototype, propTypes} = this;\n        this[INIT_ATTRS] = [];\n        if (!propTypes) return [];\n        return Object.keys(propTypes).map(prop => {\n            let attr = propToAttr(prop);\n            let schema = (propTypes[prop] === 'any' || propTypes[prop].name)\n                ? {type: propTypes[prop]} : propTypes[prop];\n            if (!(prop in prototype)) {\n                Object.defineProperty(prototype, prop, {\n                    get() {\n                        return this.props[prop]\n                    },\n                    set(nextValue) {\n                        let {value, error} = formatType(nextValue, schema.type);\n                        if (error && value != null) console.error(`[${prop}] must be type [${schema.type.name}]`);\n                        if (value === this.props[prop]) return;\n                        this.changedProps.push(prop);\n                        if (schema.reflect) {\n                            this.mounted.then(() => {\n                                this[IGNORE_ATTR] = attr;\n                                updateAttribute(this, attr, schema.type === Boolean && !value ? null : value);\n                                this[IGNORE_ATTR] = false;\n                            });\n                        }\n                        this.prevProps[prop] = this.props[prop];\n                        this.props[prop] = value;\n                        this.update();\n                    }\n                });\n            }\n            schema.value && this[INIT_ATTRS].push(self => (self[prop] = schema.value));\n            return attr;\n        });\n    }\n\n    unsubSubs = () => {\n        let {unsubs: un} = this;\n        for (let i = un.length; i--;) un[i] && un[i]();\n        this.unsubs = [];\n    };\n\n    disconnectedCallback() {\n        let {isConnected, unmount, willUnmount} = this;\n        if (isConnected) return;\n        typeof unmount === 'function' && unmount();\n        willUnmount();\n        this.unsubSubs()\n    }\n\n    onStateChange = () => {\n        return this.update();\n    };\n\n    didUpdate() {\n    }\n\n    didMount() {\n    }\n\n    beforeInitialUpdate() {\n    }\n\n    shouldUpdate() {\n    }\n\n    willUnmount() {\n    }\n}\n\nconst IGNORE_ATTR = Symbol(),\n    INIT_ATTRS = Symbol(),\n    IS_MOUNTED = Symbol(),\n    GET_ARGS = Symbol();\n\nlet NOOP = () => {\n};\nexport const propToAttr = (prop) => prop.replace(/([A-Z])/g, \"-$1\").toLowerCase();\nexport const attrToProp = (attr) => attr.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\nexport const updateAttribute = (node, attr, value) => {\n    (value === null || value === false || value === 'null' || value === 'false')\n        ? node.removeAttribute(attr)\n        : node.setAttribute(\n        attr,\n        typeof value == \"object\" ? JSON.stringify(value) : value\n        );\n};\nexport const formatType = (value, type) => {\n    if (type === 'any') return {value, error: false};\n    type = type || String;\n    if (type == Boolean) value = [true, 1, \"\", \"1\", \"true\"].includes(value);\n    else if (typeof value == \"string\") {\n        value = type == Number ? Number(value) : type == Object || type == Array ? JSON.parse(value) : value;\n    }\n    if ({}.toString.call(value) == `[object ${type.name}]`) return {\n        value,\n        error: type == Number && Number.isNaN(value)\n    };\n    return {value, error: true};\n};\n\nexport const createElem = tag => document.createElement(tag);\n\nexport const createStyleTag = (css) => {\n    let style = createElem('style');\n    style.appendChild(document.createTextNode(css));\n    return {element: style, update: (css) => style.textContent = css};\n};\n\nexport const getShadowParent = elmnt => {\n    while (elmnt.parentNode && (elmnt = elmnt.parentNode)) if (elmnt instanceof ShadowRoot) return elmnt;\n    return document;\n};\n\nexport const CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE = \"adoptedStyleSheets\" in document;\nexport const DEFAULT_SHADOWROOT_HOST_CSS_RESETS = `:host, *, *::before, *::after {box-sizing: border-box;} `;\n\nconst constructableStyleCache = new Map();\nconst constructableStyleTagFallbackCache = new Map();\n\nexport const adoptStyles = (element, cssString, options = {}) => {\n    const {async, getStringOnFallback, useStyleTag, noDefaultResets} = options;\n    cssString = (element.shadowRoot && !noDefaultResets ? DEFAULT_SHADOWROOT_HOST_CSS_RESETS : '')\n        + (cssString || options.cssString || '');\n    const signature = element.constructor.tag || element.constructor;\n    if (CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE && !useStyleTag) {\n        let adopter = element.shadowRoot || getShadowParent(element),\n            constructable = constructableStyleCache.get(signature);\n        if (!constructable) {\n            constructable = new CSSStyleSheet();\n            constructable[async ? 'replace' : 'replaceSync'](cssString);\n            constructableStyleCache.set(signature, constructable);\n        }\n        if (!([].concat(adopter.adoptedStyleSheets).includes(constructable))) {\n            adopter.adoptedStyleSheets = [...adopter.adoptedStyleSheets, constructable];\n        }\n    } else {\n        if (getStringOnFallback) return cssString;\n        let style = constructableStyleTagFallbackCache.get(signature);\n        if (!style) {\n            style = createStyleTag(cssString).element;\n            constructableStyleTagFallbackCache.set(signature, style);\n        }\n        (element.shadowRoot || element).appendChild(style.cloneNode(true));\n    }\n};\n\nconst globalStyleTagCache = new Map();\nexport const headStyleTag = (id, mount) => {\n    let style = createElem('style');\n    if (id) style.id = id;\n    style.appendChild(document.createTextNode(\"\"));\n    (mount || document.head).appendChild(style);\n    return (css) => (style.appendChild(document.createTextNode(css)), style);\n};\n\n\nexport const refs = (options) => self => {\n    let {selector = (ref) => `#${ref}`, selectMethod = 'querySelector'} = isObj(options) ? options : {},\n        refsCache = {}, root = self.shadowRoot || self;\n    return new Proxy({}, {\n        get(target, key) {\n            if (key === 'refreshRefsCache') return () => refsCache = {};\n            if (!refsCache[key]) refsCache[key] = root[selectMethod](selector(key));\n            return refsCache[key];\n        }\n    });\n};\n\nconst tagTemplateCache = new Map();\nexport const appendTemplate = (element, templateStr) => {\n    if (!element || !templateStr) return;\n    let el = element.shadowRoot || element,\n        signature = element.constructor,\n        temp = tagTemplateCache.get(signature);\n    if (!temp) {\n        temp = createElem('template');\n        temp.innerHTML = templateStr;\n        tagTemplateCache.set(signature, temp);\n    }\n    el.appendChild(temp.content.cloneNode(true));\n};\n\nlet promise = new Promise(resolve => resolve());\nexport const defer = (fn) => promise.then(fn);\n\nexport const booleanAttr = (ref, attr, bool) => ref[!!bool ? 'setAttribute' : 'removeAttribute'](attr, '');\n\nexport const createTemplate = html => {\n    let temp = createElem('template');\n    temp.innerHTML = html;\n    return temp;\n};\n\nexport const templateToHost = (host, html) => {\n    let temp = createTemplate(html);\n    host.innerHTML = '';\n    host.appendChild(temp.content.cloneNode(true));\n};\n\nexport const TemplateMapFactory = () => {\n    const cache = {};\n    return (id, content) => {\n        if (!cache[id]) {\n            cache[id] = createTemplate(content);\n        }\n        return cache[id].content.cloneNode(true);\n    }\n};\n"],"names":["Elemental","HTMLElement","constructor","props","super","this","GET_ARGS","prevProps","changedProps","emit","event","detail","opts","from","dispatchEvent","CustomEvent","bubbles","composed","eventListener","to","ev","cb","unsubs","push","renderer","render","state","shadowRoot","unsubSubs","un","i","length","onStateChange","update","shadow","styles","template","proxyRefs","attachShadow","mode","isObj","global","globalStyleTagCache","get","headStyleTag","set","initial","adoptSheets","cssStrOrObj","options","css","fallbackCssString","adoptStyles","getStringOnFallback","statics","appendTemplate","Object","assign","refs","mounted","Promise","mount","initialized","init","processing","then","_","unmount","didMount","NOOP","logic","propLogic","keys","forEach","prop","shouldUpdate","undefined","didUpdate","obi","$onChange","s","paths","defer","observe","concat","o","beforeInitialUpdate","initAttrs","INIT_ATTRS","connectedCallback","IS_MOUNTED","attributeChangedCallback","a","n","IGNORE_ATTR","attrToProp","observedAttributes","prototype","propTypes","map","attr","propToAttr","schema","name","type","defineProperty","nextValue","value","error","formatType","console","reflect","updateAttribute","Boolean","self","disconnectedCallback","isConnected","willUnmount","Symbol","replace","toLowerCase","all","letter","toUpperCase","node","removeAttribute","setAttribute","JSON","stringify","String","includes","Number","Array","parse","toString","call","isNaN","createElem","tag","document","createElement","createStyleTag","style","appendChild","createTextNode","element","textContent","getShadowParent","elmnt","parentNode","ShadowRoot","CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE","DEFAULT_SHADOWROOT_HOST_CSS_RESETS","constructableStyleCache","Map","constructableStyleTagFallbackCache","cssString","async","useStyleTag","noDefaultResets","signature","adopter","constructable","CSSStyleSheet","adoptedStyleSheets","cloneNode","id","head","selector","ref","selectMethod","refsCache","root","Proxy","target","key","tagTemplateCache","templateStr","el","temp","innerHTML","content","promise","resolve","fn","booleanAttr","bool","createTemplate","html","templateToHost","host","TemplateMapFactory","cache"],"mappings":"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"}