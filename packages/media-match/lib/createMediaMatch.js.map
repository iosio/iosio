{"version":3,"file":"createMediaMatch.js","sources":["../src/createMediaMatch.js"],"sourcesContent":["import {obi} from \"@iosio/obi\";\n\nexport const createMediaMatch = (options = {}) => {\n\n    let {\n        screenSizes = ['xs', 'xs', 'sm', 'md', 'lg', 'xl', 'xxl'],\n        customPropPrepend = '--x-mediaMatch_',\n        sizeMap = {}\n    } = options;\n\n    let  sizeCustomProperties = {\n        'xs': '360px',\n        'sm': '600px',\n        'md': '800px',\n        'lg': '960px',\n        'xl': '1280px',\n        'xxl': '1920px',\n        ...sizeMap\n    };\n\n    let mm = window.matchMedia;\n\n    const docStyle = window.getComputedStyle(document.documentElement);\n\n    let defaultNumCols = 12, numCols = docStyle.getPropertyValue(customPropPrepend + 'numCols');\n    numCols = numCols ? (parseInt(numCols) || defaultNumCols) : defaultNumCols;\n\n    let queries;\n    let updateQueries = () => {\n        queries = screenSizes.map((size, i) => {\n            const mq = docStyle.getPropertyValue(customPropPrepend + size) || sizeCustomProperties[size];\n            return `screen and (${i === 0 ? 'max' : 'min'}-width:${mq})`\n        });\n    };\n\n    let getMatches = () => [...screenSizes.filter((size, i) => !!mm(queries[i]).matches ? size : false)];\n\n    let percents = {...[...Array(numCols + 1)].map((_, i) => ((i / numCols) * 100).toFixed(8) + '%')};\n    let getStyles = (matching, propOptions) => {\n        let styleSizing = {};\n        for (let i = matching.length, propMatch, percentage; i--;) {\n            propMatch = propOptions[matching[i]];\n            percentage = percents[propMatch];\n            if ((propMatch + '') && percentage) {\n                styleSizing = {\n                    flexBasis: percentage,\n                    maxWidth: percentage,\n                    ...(propMatch === 0 ? {display: 'none'} : {})\n                };\n                break;\n            }\n        }\n        return styleSizing\n    };\n\n    updateQueries();\n    let initialMatches = getMatches();\n\n    let mediaMatch = obi({\n        matching: initialMatches,\n        match: initialMatches[initialMatches.length - 1]\n    });\n\n    let getSetMatches = () => {\n        let matches = getMatches();\n        mediaMatch.$merge({\n            matching: matches,\n            match: matches[matches.length - 1]\n        });\n    };\n    let listeners = [];\n    queries.forEach(q => listeners.push(mm(q)));\n    listeners.forEach(l => l.addListener(getSetMatches));\n\n    mediaMatch.update = () => {\n        listeners.forEach(l => l.removeListener(getSetMatches));\n        listeners = [];\n        updateQueries();\n        queries.forEach(q => listeners.push(mm(q)));\n        listeners.forEach(l => l.addListener(getSetMatches));\n    };\n\n    return {mediaMatch, getStyles, screenSizes}\n};"],"names":["createMediaMatch","options","screenSizes","customPropPrepend","sizeMap","sizeCustomProperties","xs","sm","md","lg","xl","xxl","mm","window","matchMedia","docStyle","getComputedStyle","document","documentElement","queries","numCols","getPropertyValue","parseInt","updateQueries","map","size","i","getMatches","filter","matches","percents","Array","_","toFixed","initialMatches","mediaMatch","obi","matching","match","length","getSetMatches","$merge","listeners","forEach","q","push","l","addListener","update","removeListener","getStyles","propOptions","styleSizing","propMatch","percentage","flexBasis","maxWidth","display"],"mappings":"iCAEaA,MAAAA,EAAmB,CAACC,EAAU,MAEvC,IAAIC,YACAA,EAAc,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OADnDC,kBAEAA,EAAoB,kBAFpBC,QAGAA,EAAU,IACVH,EAECI,EAAuB,CACxBC,GAAM,QACNC,GAAM,QACNC,GAAM,QACNC,GAAM,QACNC,GAAM,SACNC,IAAO,YACJP,GAGHQ,EAAKC,OAAOC,WAEhB,MAAMC,EAAWF,OAAOG,iBAAiBC,SAASC,iBAElD,IAGIC,EAHqBC,EAAUL,EAASM,iBAAiBlB,EAAoB,WACjFiB,EAAUA,GAAWE,SAASF,IADT,GAIrB,IAAIG,EAAgB,KAChBJ,EAAUjB,EAAYsB,IAAI,CAACC,EAAMC,IAErB,eAAoB,IAANA,EAAU,MAAQ,eAD7BX,EAASM,iBAAiBlB,EAAoBsB,IAASpB,EAAqBoB,QAK3FE,EAAa,IAAM,IAAIzB,EAAY0B,OAAO,CAACH,EAAMC,MAAQd,EAAGO,EAAQO,IAAIG,SAAUJ,IAElFK,EAAW,IAAI,IAAIC,MAAMX,EAAU,IAAII,IAAI,CAACQ,EAAGN,KAAQA,EAAIN,EAAW,KAAKa,QAAQ,GAAK,MAkB5FV,IACA,IAAIW,EAAiBP,IAEjBQ,EAAaC,EAAI,CACjBC,SAAUH,EACVI,MAAOJ,EAAeA,EAAeK,OAAS,KAG9CC,EAAgB,KAChB,IAAIX,EAAUF,IACdQ,EAAWM,OAAO,CACdJ,SAAUR,EACVS,MAAOT,EAAQA,EAAQU,OAAS,MAGpCG,EAAY,GAYhB,OAXAvB,EAAQwB,QAAQC,GAAKF,EAAUG,KAAKjC,EAAGgC,KACvCF,EAAUC,QAAQG,GAAKA,EAAEC,YAAYP,IAErCL,EAAWa,OAAS,KAChBN,EAAUC,QAAQG,GAAKA,EAAEG,eAAeT,IACxCE,EAAY,GACZnB,IACAJ,EAAQwB,QAAQC,GAAKF,EAAUG,KAAKjC,EAAGgC,KACvCF,EAAUC,QAAQG,GAAKA,EAAEC,YAAYP,KAGlC,CAACL,WAAAA,EAAYe,UA5CJ,CAACb,EAAUc,KACvB,IAAIC,EAAc,GAClB,IAAK,IAAyBC,EAAWC,EAAhC5B,EAAIW,EAASE,OAA+Bb,KAGjD,GAFA2B,EAAYF,EAAYd,EAASX,IACjC4B,EAAaxB,EAASuB,GACjBA,EAAY,IAAOC,EAAY,CAChCF,EAAc,CACVG,UAAWD,EACXE,SAAUF,KACQ,IAAdD,EAAkB,CAACI,QAAS,QAAU,IAE9C,MAGR,OAAOL,GA8BoBlD,YAAAA"}