import{isObj as e,isArray as t,def as s,isFunc as o,extend as r,objectIsEmpty as n,CSSTextToObj as i}from"@iosio/util";const a=document,l="adoptedStyleSheets"in document,h=e=>{let t=a.createElement("style");return t.appendChild(a.createTextNode("")),(e||a.head).appendChild(t),e=>(t.appendChild(a.createTextNode(e)),t)},d=(e,t)=>((t=t||String)==Boolean?e=[!0,1,"","1","true"].includes(e):"string"==typeof e&&(e=t==Number?Number(e):t==Object||t==Array?JSON.parse(e):e),{}.toString.call(e)==`[object ${t.name}]`?{value:e,error:t==Number&&Number.isNaN(e)}:{value:e,error:!0}),p=(e,t)=>!(!e.getAttribute||!e.localName)&&(t=e.getAttribute("is"),e.localName.includes("-")||t&&t.includes("-")),u=(s,o,r)=>{null===r||!1===r||"null"===r||"false"===r?s.removeAttribute(o):s.setAttribute(o,p(s)&&(e(r)||t(r))?JSON.stringify(r):r)},c=e=>e.replace(/([A-Z])/g,"-$1").toLowerCase(),m=e=>e.replace(/-(\w)/g,(e,t)=>t.toUpperCase()),b=(e,t)=>{let s=!1;return l&&(s=new CSSStyleSheet,s[t?"replace":"replaceSync"](e)),[s,e]},y=e=>{for(;e.parentNode&&(e=e.parentNode);)if(e instanceof ShadowRoot)return e;return document},S=({styleSheets:e,getCombined:s,element:o})=>{let r=o.shadowRoot||y(o),n="",i=l&&!s?e=>{let s=t(e)?e[0]:e;s&&![].concat(r.adoptedStyleSheets).includes(s)&&(r.adoptedStyleSheets=[...r.adoptedStyleSheets,s])}:e=>{t(e)&&e[1]&&(n+=e[1])};return[].concat(e).forEach(i),n},g={},f={},v=":host, *, *::before, *::after {box-sizing: border-box;} ",w=e=>{let t=document.createElement("style"),s=document.createTextNode(e);return t.appendChild(s),{element:t,update:e=>s.replaceWith(document.createTextNode(e))}},C=(e,t,s,o,r)=>{if(s=(t.shadowRoot?":host, *, *::before, *::after {box-sizing: border-box;} ":"")+s,l&&!r){let r=t.shadowRoot||y(t),n=g[e];n||(n=new CSSStyleSheet,n[o?"replace":"replaceSync"](s),g[e]=n),[].concat(r.adoptedStyleSheets).includes(n)||(r.adoptedStyleSheets=[...r.adoptedStyleSheets,n])}else{let o=f[e];o||(o=w(s).element,f[e]=o),(t.shadowRoot||t).appendChild(o.cloneNode(!0))}},T=(e,t)=>(e.shadowRoot||e).querySelector(t),E=(e,t,s)=>t.reduce((t,o)=>(t[o]=T(e,(s||"")+o),t),{}),x=(e,t)=>E(e,t,"#"),A={},R=(e,t,s)=>{if(!e||!t||!s)return;let o=t.shadowRoot||t,r=A[e];r||(r=document.createElement("template"),r.innerHTML=s,A[e]=r),o.appendChild(r.content.cloneNode(!0))},N=e=>{let t;return s=>{t=document.createElement("template"),t.innerHTML=s,e.innerHTML="",e.appendChild(t.content.cloneNode(!0))}},M=e=>{let t,s={},o=e.attributes;for(t=o.length;t--;)s[o[t].name]=o[t].value;return s},P=e=>new Proxy({},{get(t,s){let o=t[s];return t[s]?t[s]:(o=e(s),t[s]=o,o)}}),O=(e,t)=>new Proxy({},{set(s,o,r){t&&u(e,o,r)},get:(t,s)=>e.getAttribute(s)}),_=()=>{let e,t,s=new Promise(t=>e=t);return{promise:s,resolve:e,processing:t,updater:e=>(...o)=>{console.log("updating"),t||(t=s.then(s=>{e&&e(...o),t=!1}))}}},U=e=>{let t={};const{promise:o,resolve:r,updater:n}=_();return{mount:r,mounted:o,def:(o,r,i)=>{const a=n(r);Object.keys(o).forEach(r=>{t[r]=o[r],s(e,r,{set(s){t[r]!==s&&(t[r]=s,i&&u(e,r,s),a(t))},get:()=>t[r]})})}}},k=(e,t)=>{let r={};const{promise:n,resolve:i,updater:a}=_();return Object.keys(t).forEach(i=>{a((t,s)=>{u(e,t,s)}),s(e.prototype,i,{set(s){console.log("setting property",i,"with",s);let a=t[i],l=s;o(a)?l=a(s):(console.log("formatting type",s,a),l=d(l,a).value),r[i]!==l&&(r[i]=l,console.log("updating attribute",i,l),n.then(()=>{u(e,i,l)}))},get:()=>r[i]})}),{mount:t=>{e=t,i()}}},L=(e,t,s,o={})=>e.dispatchEvent(new CustomEvent(t,{detail:s,bubbles:!0,composed:!0,...o})),j=Symbol(),H={construct:e=>{let{initAttrs:t}=e.constructor;e.prevProps={},e.props={},e.mounted=new Promise(t=>e._mount=t),e.update=()=>(e.processing||(e.processing=e.mounted.then(t=>{e.hasMounted?e.didUpdate&&e.didUpdate(e.props,e.prevProps):(e.didMount&&e.didMount(e.props,e.prevProps),e.hasMounted=!0),e.processing=!1})),e.processing);let s=t.length;for(;s--;)t[s](e);e.update()},observedAttrs:(e,t=[])=>{let{prototype:o,propTypes:r}=e;return e.initAttrs=[],r?Object.keys(r).map(t=>{let n=c(t),i=r[t].name?{type:r[t]}:r[t];return t in o||s(o,t,{get(){return this.props[t]},set(e){let{value:s,error:o}=d(e,i.type);o&&null!=s&&console.error(`[${t}] must be type [${i.type.name}]`),s!==this.props[t]&&(i.reflect&&this.mounted.then(()=>{this[j]=n,u(this,n,i.type!==Boolean||s?s:null),this[j]=!1}),this.prevProps[t]=this.props[t],this.props[t]=s,this.update())}}),i.value&&e.initAttrs.push(e=>e[t]=i.value),n}):[]},connect:e=>{e.hasMounted||e._mount()},attrChange:(e,t,s,o)=>{o[j]!==e&&t!==s&&(o[m(e)]=s)}},$=()=>H,{construct:B,observedAttrs:F,connect:z,attrChange:D}=H;class I extends HTMLElement{static get observedAttributes(){return F(this)}constructor(){super(),B(this)}connectedCallback(){z(this)}attributeChangedCallback(e,t,s){D(e,t,s,this)}}const J=!1,V=({h:e,render:t,setProperty:a})=>{const p={};let b=Symbol(),y={};const g=h();class f extends HTMLElement{constructor(){super(),this.context=y,this.unsubs=[],this.state={},this.observe=null;let{initAttrs:s,shadow:h,rootSheet:d,noRerender:u,tag:c}=this.constructor,m=h?this.attachShadow({mode:!0===h?"open":h}):this;this.props={},this.render=this.render.bind(this),this.mounted=new Promise(e=>this._mount=e);let b="",f=0,v=!1;const w=({css:t,noResets:s,globalFallback:o,useStyleTag:r,styleSheets:n,children:i})=>{if(f>0)return null;if(f++,!1!==v)return v;let a=t||i||"";return!s&&h&&(a=":host, *, *::before, *::after {box-sizing: border-box;} "+a),l&&!r?(S({styleSheets:d,element:this}),0===d.cssRules.length&&d.replaceSync(a),n&&S({styleSheets:n,element:this}),v=null):(b=a+S({styleSheets:d,element:this,getCombined:!0})+(n?S({styleSheets:n,element:this,getCombined:!0}):""),o&&!p[c]?(p[c]=!0,g(b),v=null):v=e("style",{},b)),v};let C;const T=({children:e,...t})=>{if(!this.hasMounted&&n(t))return C=!0,e;if(C&&n(t))return e;C=!1;let s,o={},r=this.attributes;for(s=r.length;s--;)o[r[s].name]=r[s].value;for(let e in t)a(this,e,t[e],o[e],!1);return e};this.setState=e=>(this.state={...this.state,...o(e)?e(this.state):e||{}},this.update()),this.observeObi=e=>[].concat(e).forEach(e=>e.$onChange&&this.unsubs.push(e.$onChange(this.update)));const E=()=>(this._observesStyle&&(this.props.style=i(this.style.cssText)),[r({Host:T,CSS:w,host:this},this.props),this.state,this.context]),x=()=>{let e=E();this.willMount(...e),this.willRender(...e),t(this.render(...e),m),f=0,this.hasMounted=!0,setTimeout(()=>{this.unsubs.push(this.lifeCycle(...e)),this.didRender(...e),this.didMount(...e)})},A=()=>{let e=E(),s=this.willRender(...e);this.willUpdate(...e),this.shouldUpdate&&(s=this.shouldUpdate(...e)),u||!s&&void 0!==s||(t(this.render(...e),m),f=0,this.didUpdate(...e),this.didRender(...e))};this.update=()=>(this.processing||(this.processing=this.mounted.then(e=>{this.hasMounted?A():x(),this.processing=!1})),this.processing),this.emit=(e,t,s,o)=>(s||this).dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,...o})),this.destroy=()=>{this.willUnmount(),t(null,m),this.unsubs.forEach(e=>o(e)&&e())};let R=s.length;for(;R--;)s[R](this);this.update()}connectedCallback(){this.hasMounted||(this.observe&&this.observeObi(this.observe),this._mount())}disconnectedCallback(){this.isConnected||this.destroy()}attributeChangedCallback(e,t,s){this[b]!==e&&t!==s&&("style"===e&&this._observesStyle?this.update():this[m(e)]=s)}static get observedAttributes(){let{propTypes:e,prototype:t}=this;if(this.initAttrs=[],!e)return[];let o=Object.keys(e).map(o=>{let r=c(o),n=e[o].name?{type:e[o]}:e[o];return o in t||s(t,o,{get(){return this.props[o]},set(e){let{value:t,error:s}=d(e,n.type);s&&null!=t&&console.error(`[${o}] must be type [${n.type.name}]`),t!==this.props[o]&&(n.reflect&&this.mounted.then(()=>{this[b]=r,u(this,r,n.type!==Boolean||t?t:null),this[b]=!1}),this.props[o]=t,this.update())}}),n.value&&this.initAttrs.push(e=>e[o]=n.value),r});return this.prototype._observesStyle=o.includes("style"),o}willMount(){}willRender(){}render(){}didRender(){}willUpdate(){}didUpdate(){}didMount(){}lifeCycle(){}willUnmount(){}}const v=(t,s,o={})=>{var r,n;let i,a=s.prototype instanceof f;return l&&(i=new CSSStyleSheet),a&&(s.rootSheet=i,s.tag=t),customElements.define(t,a?s:(n=r=class extends f{constructor(...e){super(...e),this.render=s}},r.rootSheet=i,r.tag=t,r.propTypes=o.propTypes,r.shadow=o.shadow,r.noRerender=o.noRerender,n)),s=>e(t,s)};let w,C,T=()=>{};return customElements.get("x-x")||customElements.get("x-shadow")||(w=v("x-x",T),C=v("x-shadow",T,{shadow:!0})),{x:v,X:w,XShadow:C,Element:f,provide:(e,t)=>y[e]=t}};export{l as CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE,v as DEFAULT_SHADOWROOT_HOST_CSS_RESETS,U as ProxyProps,I as ReactiveElement,J as TEST_ENV,N as UpdatableTemplate,S as adoptSheets,C as adoptStyles,R as appendTemplate,m as attrToProp,V as createBase,$ as createReactiveProps,E as createRefs,x as createRefsFromIDs,b as createStyleSheet,w as createStyleTag,a as d,L as emit,d as formatType,M as getElementProps,y as getShadowParent,h as headStyleTag,p as isCustomElement,P as makeProxyObj,c as propToAttr,O as proxyAttrs,k as reflectPropsToAttrs,T as select,u as updateAttribute};
//# sourceMappingURL=index.js.map
