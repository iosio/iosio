{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {obi} from \"@iosio/obi\";\nimport {eventListener, isObj} from \"@iosio/util\";\nimport {h, render, Fragment, createNode, mount} from \"@iosio/vdom\";\n\nexport {h, render, Fragment, createNode, mount};\n\nexport class Elemental extends HTMLElement {\n    constructor(props) {\n        super(props);\n        const {shadow, styles, template, proxyRefs} = this.constructor;\n        shadow && this.attachShadow({mode: 'open'});\n        if (isObj(styles) && styles.global && !globalStyleTagCache.get(this.constructor)) {\n            headStyleTag()(styles.global);\n            globalStyleTagCache.set(this.constructor, true);\n        }\n        let initial = true, adoptSheets = (cssStrOrObj) => {\n            let {options = {}, css = ''} = isObj(cssStrOrObj) ? cssStrOrObj : {css: cssStrOrObj};\n            this.fallbackCssString = adoptStyles(this, css, {\n                getStringOnFallback: !!this.render, ...options\n            })\n        }, statics = () => {\n            styles && adoptSheets(styles);\n            template && appendTemplate(this, template);\n        };\n\n        Object.assign(this, {\n            unsubs: [],\n            refs: proxyRefs ? refs(proxyRefs)(this) : {},\n            props: {},\n            prevProps: {},\n            changedProps: [],\n            mounted: new Promise(mount => (this.mount = mount)),\n            initialized: new Promise(mount => (this.init = mount)),\n            update: () => {\n                if (!this.processing) {\n                    this.processing = this.mounted.then(_ => {\n                        this.render && this.renderer();\n                        if (initial) {\n                            this.unmount = this.didMount(...this[GET_ARGS]()) || NOOP;\n                            const logic = this.propLogic && this.propLogic(true);\n                            logic && Object.keys(this.props).forEach(prop => {\n                                logic[prop] && logic[prop](this.props[prop], this.refs);\n                            });\n                        } else {\n                            const shouldUpdate = this.shouldUpdate(...this[GET_ARGS]());\n                            if (shouldUpdate || shouldUpdate === undefined) {\n                                this.didUpdate(...this[GET_ARGS]());\n                                const logic = this.propLogic && this.propLogic();\n                                logic && this.changedProps.forEach(prop =>\n                                    logic[prop] && logic[prop](this.props[prop], this.refs)\n                                )\n                            }\n                        }\n                        initial = false;\n                        this.changedProps = [];\n                        this.processing = false;\n                    })\n                }\n                return this.processing;\n            }\n        });\n\n        shadow && statics();\n        this.initialized.then(() => {\n            !shadow && statics();\n            if (this.state) {\n                this.unsubs.push((this.state = obi(this.state)).$onChange((s, paths) =>\n                    defer(() => this.onStateChange(s, paths))\n                ));\n            }\n            this.beforeInitialUpdate(...this[GET_ARGS]());\n            this.mount();\n        });\n\n        let initAttrs = this.constructor[INIT_ATTRS], length = initAttrs.length;\n        while (length--) initAttrs[length](this);\n        this.update();\n    };\n\n    [GET_ARGS] = () => [this.props, this.prevProps, this.changedProps];\n\n    emit = (event, detail, opts = {}, from = this) => from.dispatchEvent(\n        new CustomEvent(event, {detail: detail, bubbles: true, composed: true, ...opts})\n    );\n\n    eventListener = (to, ev, cb, opts) => this.unsubs.push(eventListener(to, ev, cb, opts));\n\n    renderer = () => {\n        let results = this.render(this.props, this.state);\n        if (!results) return;\n        if (this.fallbackCssString) {\n            let style = h('style', {dangerouslySetInnerHTML: {__html: this.fallbackCssString || ''}});\n            results = Array.isArray(results) ? (results.unshift(style), results) : [style, results];\n        }\n        render(this.shadowRoot || this, results);\n    };\n\n    connectedCallback() {\n        if (this[IS_MOUNTED]) return;\n        this[IS_MOUNTED] = true;\n        this.init();\n    }\n\n    attributeChangedCallback(a, o, n) {\n        if (this[IGNORE_ATTR] === a || o === n) return;\n        this[attrToProp(a)] = n;\n    }\n\n    static get observedAttributes() {\n        let {prototype, propTypes} = this;\n        this[INIT_ATTRS] = [];\n        if (!propTypes) return [];\n        return Object.keys(propTypes).map(prop => {\n            let attr = propToAttr(prop);\n            let schema = (propTypes[prop] === 'any' || propTypes[prop].name)\n                ? {type: propTypes[prop]} : propTypes[prop];\n            if (!(prop in prototype)) {\n                Object.defineProperty(prototype, prop, {\n                    get() {\n                        return this.props[prop]\n                    },\n                    set(nextValue) {\n                        let {value, error} = formatType(nextValue, schema.type);\n                        if (error && value != null) console.error(`[${prop}] must be type [${schema.type.name}]`);\n                        if (value === this.props[prop]) return;\n                        this.changedProps.push(prop);\n                        if (schema.reflect) {\n                            this.mounted.then(() => {\n                                this[IGNORE_ATTR] = attr;\n                                updateAttribute(this, attr, schema.type === Boolean && !value ? null : value);\n                                this[IGNORE_ATTR] = false;\n                            });\n                        }\n                        this.prevProps[prop] = this.props[prop];\n                        this.props[prop] = value;\n                        this.update();\n                    }\n                });\n            }\n            schema.value && this[INIT_ATTRS].push(self => (self[prop] = schema.value));\n            return attr;\n        });\n    }\n\n    disconnectedCallback() {\n        let {isConnected, unmount, willUnmount, unsubs: un} = this;\n        if (isConnected) return;\n        typeof unmount === 'function' && unmount();\n        willUnmount();\n        for (let i = un.length; i--;) un[i] && un[i]();\n    }\n\n    onStateChange = () => {\n        return this.update();\n    };\n\n    didUpdate() {\n    }\n\n    didMount() {\n    }\n\n    beforeInitialUpdate() {\n    }\n\n    shouldUpdate() {\n    }\n\n    willUnmount() {\n    }\n}\n\nconst IGNORE_ATTR = Symbol(),\n    INIT_ATTRS = Symbol(),\n    IS_MOUNTED = Symbol(),\n    GET_ARGS = Symbol();\n\nlet NOOP = () => {\n};\nexport const propToAttr = (prop) => prop.replace(/([A-Z])/g, \"-$1\").toLowerCase();\nexport const attrToProp = (attr) => attr.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\nexport const updateAttribute = (node, attr, value) => {\n    (value === null || value === false || value === 'null' || value === 'false')\n        ? node.removeAttribute(attr)\n        : node.setAttribute(\n        attr,\n        typeof value == \"object\" ? JSON.stringify(value) : value\n        );\n};\nexport const formatType = (value, type) => {\n    if (type === 'any') return {value, error: false};\n    type = type || String;\n    if (type == Boolean) value = [true, 1, \"\", \"1\", \"true\"].includes(value);\n    else if (typeof value == \"string\") {\n        value = type == Number ? Number(value) : type == Object || type == Array ? JSON.parse(value) : value;\n    }\n    if ({}.toString.call(value) == `[object ${type.name}]`) return {\n        value,\n        error: type == Number && Number.isNaN(value)\n    };\n    return {value, error: true};\n};\n\nexport const createStyleTag = (css) => {\n    let style = document.createElement('style');\n    style.appendChild(document.createTextNode(css));\n    return {element: style, update: (css) => style.textContent = css};\n};\n\nexport const getShadowParent = elmnt => {\n    while (elmnt.parentNode && (elmnt = elmnt.parentNode)) if (elmnt instanceof ShadowRoot) return elmnt;\n    return document;\n};\n\nexport const CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE = \"adoptedStyleSheets\" in document;\nexport const DEFAULT_SHADOWROOT_HOST_CSS_RESETS = `:host, *, *::before, *::after {box-sizing: border-box;} `;\n\nconst constructableStyleCache = new Map();\nconst constructableStyleTagFallbackCache = new Map();\n\nexport const adoptStyles = (element, cssString, options = {}) => {\n    const {async, getStringOnFallback, useStyleTag, noDefaultResets} = options;\n    cssString = (element.shadowRoot && !noDefaultResets ? DEFAULT_SHADOWROOT_HOST_CSS_RESETS : '')\n        + (cssString || options.cssString || '');\n    const signature = element.constructor.tag || element.constructor;\n    if (CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE && !useStyleTag) {\n        let adopter = element.shadowRoot || getShadowParent(element),\n            constructable = constructableStyleCache.get(signature);\n        if (!constructable) {\n            constructable = new CSSStyleSheet();\n            constructable[async ? 'replace' : 'replaceSync'](cssString);\n            constructableStyleCache.set(signature, constructable);\n        }\n        if (!([].concat(adopter.adoptedStyleSheets).includes(constructable))) {\n            adopter.adoptedStyleSheets = [...adopter.adoptedStyleSheets, constructable];\n        }\n    } else {\n        if (getStringOnFallback) return cssString;\n        let style = constructableStyleTagFallbackCache.get(signature);\n        if (!style) {\n            style = createStyleTag(cssString).element;\n            constructableStyleTagFallbackCache.set(signature, style);\n        }\n        (element.shadowRoot || element).appendChild(style.cloneNode(true));\n    }\n};\n\nconst globalStyleTagCache = new Map();\nexport const headStyleTag = (id, mount) => {\n    let style = document.createElement('style');\n    if (id) style.id = id;\n    style.appendChild(document.createTextNode(\"\"));\n    (mount || document.head).appendChild(style);\n    return (css) => (style.appendChild(document.createTextNode(css)), style);\n};\n\n\nexport const refs = (options) => self => {\n    let {selector = (ref) => `#${ref}`, selectMethod = 'querySelector'} = isObj(options) ? options : {},\n        refsCache = {}, root = self.shadowRoot || self;\n    return new Proxy({}, {\n        get(target, key) {\n            if (key === 'refreshRefsCache') return () => refsCache = {};\n            if (!refsCache[key]) refsCache[key] = root[selectMethod](selector(key));\n            return refsCache[key];\n        }\n    });\n};\n\nconst tagTemplateCache = new Map();\nexport const appendTemplate = (element, templateStr) => {\n    if (!element || !templateStr) return;\n    let el = element.shadowRoot || element,\n        signature = element.constructor,\n        temp = tagTemplateCache.get(signature);\n    if (!temp) {\n        temp = document.createElement('template');\n        temp.innerHTML = templateStr;\n        tagTemplateCache.set(signature, temp);\n    }\n    el.appendChild(temp.content.cloneNode(true));\n};\n\nlet promise = new Promise(resolve => resolve());\nexport const defer = (fn) => promise.then(fn);\n\nexport const booleanAttr = (ref, attr, bool) => ref[!!bool ? 'setAttribute' : 'removeAttribute'](attr, '');\n\nexport const createTemplate = html => {\n    let temp = document.createElement('template');\n    temp.innerHTML = html;\n    return temp;\n};\n\nexport const templateToHost = (host, html) => {\n    let temp = createTemplate(html);\n    host.innerHTML = '';\n    host.appendChild(temp.content.cloneNode(true));\n};\n\nexport const TemplateMapFactory = () => {\n    const cache = {};\n    return (id, content) => {\n        if (!cache[id]) {\n            cache[id] = createTemplate(content);\n        }\n        return cache[id].content.cloneNode(true);\n    }\n};\n"],"names":["Elemental","HTMLElement","constructor","props","super","this","GET_ARGS","prevProps","changedProps","emit","event","detail","opts","from","dispatchEvent","CustomEvent","bubbles","composed","eventListener","to","ev","cb","unsubs","push","renderer","results","render","state","fallbackCssString","style","h","dangerouslySetInnerHTML","__html","Array","isArray","unshift","shadowRoot","onStateChange","update","shadow","styles","template","proxyRefs","attachShadow","mode","isObj","global","globalStyleTagCache","get","headStyleTag","set","initial","adoptSheets","cssStrOrObj","options","css","adoptStyles","getStringOnFallback","statics","appendTemplate","Object","assign","refs","mounted","Promise","mount","initialized","init","processing","then","_","unmount","didMount","NOOP","logic","propLogic","keys","forEach","prop","shouldUpdate","undefined","didUpdate","obi","$onChange","s","paths","defer","beforeInitialUpdate","initAttrs","INIT_ATTRS","length","connectedCallback","IS_MOUNTED","attributeChangedCallback","a","o","n","IGNORE_ATTR","attrToProp","observedAttributes","prototype","propTypes","map","attr","propToAttr","schema","name","type","defineProperty","nextValue","value","error","formatType","console","reflect","updateAttribute","Boolean","self","disconnectedCallback","isConnected","willUnmount","un","i","Symbol","replace","toLowerCase","all","letter","toUpperCase","node","removeAttribute","setAttribute","JSON","stringify","String","includes","Number","parse","toString","call","isNaN","createStyleTag","document","createElement","appendChild","createTextNode","element","textContent","getShadowParent","elmnt","parentNode","ShadowRoot","CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE","DEFAULT_SHADOWROOT_HOST_CSS_RESETS","constructableStyleCache","Map","constructableStyleTagFallbackCache","cssString","async","useStyleTag","noDefaultResets","signature","tag","adopter","constructable","CSSStyleSheet","concat","adoptedStyleSheets","cloneNode","id","head","selector","ref","selectMethod","refsCache","root","Proxy","target","key","tagTemplateCache","templateStr","el","temp","innerHTML","content","promise","resolve","fn","booleanAttr","bool","createTemplate","html","templateToHost","host","TemplateMapFactory","cache"],"mappings":"sMAMaA,UAAkBC,YAC3BC,YAAYC,GACRC,MAAMD,GADSE,KAwElBC,GAAY,IAAM,CAACD,KAAKF,MAAOE,KAAKE,UAAWF,KAAKG,mBAErDC,KAAO,CAACC,EAAOC,EAAQC,EAAO,GAAIC,EAAOR,OAASQ,EAAKC,cACnD,IAAIC,YAAYL,EAAO,CAACC,OAAQA,EAAQK,SAAS,EAAMC,UAAU,KAASL,UAG9EM,cAAgB,CAACC,EAAIC,EAAIC,EAAIT,IAASP,KAAKiB,OAAOC,KAAKL,EAAcC,EAAIC,EAAIC,EAAIT,SAEjFY,SAAW,KACP,IAAIC,EAAUpB,KAAKqB,OAAOrB,KAAKF,MAAOE,KAAKsB,OAC3C,GAAKF,EAAL,CACA,GAAIpB,KAAKuB,kBAAmB,CACxB,IAAIC,EAAQC,EAAE,QAAS,CAACC,wBAAyB,CAACC,OAAQ3B,KAAKuB,mBAAqB,MACpFH,EAAUQ,MAAMC,QAAQT,IAAYA,EAAQU,QAAQN,GAAQJ,GAAW,CAACI,EAAOJ,GAEnFC,EAAOrB,KAAK+B,YAAc/B,KAAMoB,UA0DpCY,cAAgB,SACAC,SAhJZ,MAAMC,OAACA,EAADC,OAASA,EAATC,SAAiBA,EAAjBC,UAA2BA,GAAarC,KAAKH,YACnDqC,GAAUlC,KAAKsC,aAAa,CAACC,KAAM,SAC/BC,EAAML,IAAWA,EAAOM,SAAWC,EAAoBC,IAAI3C,KAAKH,eAChE+C,GAAAA,CAAeT,EAAOM,QACtBC,EAAoBG,IAAI7C,KAAKH,aAAa,IAE9C,IAAIiD,GAAU,EAAMC,EAAeC,IAC/B,IAAIC,QAACA,EAAU,GAAXC,IAAeA,EAAM,IAAMV,EAAMQ,GAAeA,EAAc,CAACE,IAAKF,GACxEhD,KAAKuB,kBAAoB4B,EAAYnD,KAAMkD,EAAK,CAC5CE,sBAAuBpD,KAAKqB,UAAW4B,KAE5CI,EAAU,KACTlB,GAAUY,EAAYZ,GACtBC,GAAYkB,EAAetD,KAAMoC,IAGrCmB,OAAOC,OAAOxD,KAAM,CAChBiB,OAAQ,GACRwC,KAAMpB,EAAYoB,EAAKpB,EAALoB,CAAgBzD,MAAQ,GAC1CF,MAAO,GACPI,UAAW,GACXC,aAAc,GACduD,QAAS,IAAIC,QAAQC,GAAU5D,KAAK4D,MAAQA,GAC5CC,YAAa,IAAIF,QAAQC,GAAU5D,KAAK8D,KAAOF,GAC/C3B,OAAQ,KACCjC,KAAK+D,aACN/D,KAAK+D,WAAa/D,KAAK0D,QAAQM,KAAKC,IAEhC,GADAjE,KAAKqB,QAAUrB,KAAKmB,WAChB2B,EAAS,CACT9C,KAAKkE,QAAUlE,KAAKmE,YAAYnE,KAAKC,OAAgBmE,EACrD,MAAMC,EAAQrE,KAAKsE,WAAatE,KAAKsE,WAAU,GAC/CD,GAASd,OAAOgB,KAAKvE,KAAKF,OAAO0E,QAAQC,IACrCJ,EAAMI,IAASJ,EAAMI,GAAMzE,KAAKF,MAAM2E,GAAOzE,KAAKyD,YAEnD,CACH,MAAMiB,EAAe1E,KAAK0E,gBAAgB1E,KAAKC,MAC/C,GAAIyE,QAAiCC,IAAjBD,EAA4B,CAC5C1E,KAAK4E,aAAa5E,KAAKC,MACvB,MAAMoE,EAAQrE,KAAKsE,WAAatE,KAAKsE,YACrCD,GAASrE,KAAKG,aAAaqE,QAAQC,GAC/BJ,EAAMI,IAASJ,EAAMI,GAAMzE,KAAKF,MAAM2E,GAAOzE,KAAKyD,QAI9DX,GAAU,EACV9C,KAAKG,aAAe,GACpBH,KAAK+D,YAAa,UAGdA,cAIpB7B,GAAUmB,IACVrD,KAAK6D,YAAYG,KAAK,MACjB9B,GAAUmB,IACPrD,KAAKsB,OACLtB,KAAKiB,OAAOC,MAAMlB,KAAKsB,MAAQuD,EAAI7E,KAAKsB,QAAQwD,UAAU,CAACC,EAAGC,IAC1DC,EAAM,IAAMjF,KAAKgC,cAAc+C,EAAGC,MAG1ChF,KAAKkF,uBAAuBlF,KAAKC,MACjCD,KAAK4D,UAGT,IAAIuB,EAAYnF,KAAKH,YAAYuF,GAAaC,EAASF,EAAUE,OACjE,KAAOA,KAAUF,EAAUE,GAAQrF,MACnCA,KAAKiC,SAqBTqD,oBACQtF,KAAKuF,KACTvF,KAAKuF,IAAc,EACnBvF,KAAK8D,QAGT0B,yBAAyBC,EAAGC,EAAGC,GACvB3F,KAAK4F,KAAiBH,GAAKC,IAAMC,IACrC3F,KAAK6F,EAAWJ,IAAME,GAG1BG,gCACI,IAAIC,UAACA,EAADC,UAAYA,GAAahG,KAE7B,OADAA,KAAKoF,GAAc,GACdY,EACEzC,OAAOgB,KAAKyB,GAAWC,IAAIxB,IAC9B,IAAIyB,EAAOC,EAAW1B,GAClB2B,EAA8B,QAApBJ,EAAUvB,IAAmBuB,EAAUvB,GAAM4B,KACrD,CAACC,KAAMN,EAAUvB,IAASuB,EAAUvB,GAyB1C,OAxBMA,KAAQsB,GACVxC,OAAOgD,eAAeR,EAAWtB,EAAM,CACnC9B,MACI,YAAY7C,MAAM2E,IAEtB5B,IAAI2D,GACA,IAAIC,MAACA,EAADC,MAAQA,GAASC,EAAWH,EAAWJ,EAAOE,MAC9CI,GAAkB,MAATD,GAAeG,QAAQF,MAAO,IAAGjC,oBAAuB2B,EAAOE,KAAKD,SAC7EI,IAAUzG,KAAKF,MAAM2E,KACzBzE,KAAKG,aAAae,KAAKuD,GACnB2B,EAAOS,SACP7G,KAAK0D,QAAQM,KAAK,KACdhE,KAAK4F,GAAeM,EACpBY,EAAgB9G,KAAMkG,EAAME,EAAOE,OAASS,SAAYN,EAAeA,EAAP,MAChEzG,KAAK4F,IAAe,IAG5B5F,KAAKE,UAAUuE,GAAQzE,KAAKF,MAAM2E,GAClCzE,KAAKF,MAAM2E,GAAQgC,EACnBzG,KAAKiC,aAIjBmE,EAAOK,OAASzG,KAAKoF,GAAYlE,KAAK8F,GAASA,EAAKvC,GAAQ2B,EAAOK,OAC5DP,IA7BY,GAiC3Be,uBACI,IAAIC,YAACA,EAADhD,QAAcA,EAAdiD,YAAuBA,EAAalG,OAAQmG,GAAMpH,KACtD,IAAIkH,EAAJ,CACmB,mBAAZhD,GAA0BA,IACjCiD,IACA,IAAK,IAAIE,EAAID,EAAG/B,OAAQgC,KAAMD,EAAGC,IAAMD,EAAGC,MAO9CzC,aAGAT,YAGAe,uBAGAR,gBAGAyC,gBAIJ,MAAMvB,EAAc0B,SAChBlC,EAAakC,SACb/B,EAAa+B,SACbrH,EAAWqH,SAEf,IAAIlD,EAAO,OAEE+B,MAAAA,EAAc1B,GAASA,EAAK8C,QAAQ,WAAY,OAAOC,cACvD3B,EAAcK,GAASA,EAAKqB,QAAQ,SAAU,CAACE,EAAKC,IAAWA,EAAOC,eACtEb,EAAkB,CAACc,EAAM1B,EAAMO,KAC7B,OAAVA,IAA4B,IAAVA,GAA6B,SAAVA,GAA8B,UAAVA,EACpDmB,EAAKC,gBAAgB3B,GACrB0B,EAAKE,aACP5B,EACgB,iBAATO,EAAoBsB,KAAKC,UAAUvB,GAASA,IAG9CE,EAAa,CAACF,EAAOH,IACjB,QAATA,EAAuB,CAACG,MAAAA,EAAOC,OAAO,KAC1CJ,EAAOA,GAAQ2B,SACHlB,QAASN,EAAQ,EAAC,EAAM,EAAG,GAAI,IAAK,QAAQyB,SAASzB,GACxC,iBAATA,IACZA,EAAQH,GAAQ6B,OAASA,OAAO1B,GAASH,GAAQ/C,QAAU+C,GAAQ1E,MAAQmG,KAAKK,MAAM3B,GAASA,GAE/F,GAAG4B,SAASC,KAAK7B,IAAW,WAAUH,EAAKD,QAAgB,CAC3DI,MAAAA,EACAC,MAAOJ,GAAQ6B,QAAUA,OAAOI,MAAM9B,IAEnC,CAACA,MAAAA,EAAOC,OAAO,IAGb8B,EAAkBtF,IAC3B,IAAI1B,EAAQiH,SAASC,cAAc,SAEnC,OADAlH,EAAMmH,YAAYF,SAASG,eAAe1F,IACnC,CAAC2F,QAASrH,EAAOS,OAASiB,GAAQ1B,EAAMsH,YAAc5F,IAGpD6F,EAAkBC,IAC3B,KAAOA,EAAMC,aAAeD,EAAQA,EAAMC,aAAa,GAAID,aAAiBE,WAAY,OAAOF,EAC/F,OAAOP,UAGEU,EAAuC,uBAAwBV,SAC/DW,EAAsC,2DAE7CC,EAA0B,IAAIC,IAC9BC,EAAqC,IAAID,IAElCnG,EAAc,CAAC0F,EAASW,EAAWvG,EAAU,MACtD,MAAMwG,MAACA,EAADrG,oBAAQA,EAARsG,YAA6BA,EAA7BC,gBAA0CA,GAAmB1G,EACnEuG,GAAaX,EAAQ9G,aAAe4H,EAPW,2DAO4C,KACpFH,GAAavG,EAAQuG,WAAa,IACzC,MAAMI,EAAYf,EAAQhJ,YAAYgK,KAAOhB,EAAQhJ,YACrD,GAAIsJ,IAAyCO,EAAa,CACtD,IAAII,EAAUjB,EAAQ9G,YAAcgH,EAAgBF,GAChDkB,EAAgBV,EAAwB1G,IAAIiH,GAC3CG,IACDA,EAAgB,IAAIC,cACpBD,EAAcN,EAAQ,UAAY,eAAeD,GACjDH,EAAwBxG,IAAI+G,EAAWG,IAErC,GAAGE,OAAOH,EAAQI,oBAAoBhC,SAAS6B,KACjDD,EAAQI,mBAAqB,IAAIJ,EAAQI,mBAAoBH,QAE9D,CACH,GAAI3G,EAAqB,OAAOoG,EAChC,IAAIhI,EAAQ+H,EAAmC5G,IAAIiH,GAC9CpI,IACDA,EAAQgH,EAAegB,GAAWX,QAClCU,EAAmC1G,IAAI+G,EAAWpI,KAErDqH,EAAQ9G,YAAc8G,GAASF,YAAYnH,EAAM2I,WAAU,MAI9DzH,EAAsB,IAAI4G,IACnB1G,EAAe,CAACwH,EAAIxG,KAC7B,IAAIpC,EAAQiH,SAASC,cAAc,SAInC,OAHI0B,IAAI5I,EAAM4I,GAAKA,GACnB5I,EAAMmH,YAAYF,SAASG,eAAe,MACzChF,GAAS6E,SAAS4B,MAAM1B,YAAYnH,GAC7B0B,IAAS1B,EAAMmH,YAAYF,SAASG,eAAe1F,IAAO1B,IAIzDiC,EAAQR,GAAY+D,IAC7B,IAAIsD,SAACA,EAAYC,CAAAA,GAAS,IAAGA,KAAzBC,aAAgCA,EAAe,iBAAmBhI,EAAMS,GAAWA,EAAU,GAC7FwH,EAAY,GAAIC,EAAO1D,EAAKjF,YAAciF,EAC9C,WAAW2D,MAAM,GAAI,CACjBhI,IAAG,CAACiI,EAAQC,IACI,qBAARA,EAAmC,IAAMJ,EAAY,IACpDA,EAAUI,KAAMJ,EAAUI,GAAOH,EAAKF,GAAcF,EAASO,KAC3DJ,EAAUI,OAKvBC,EAAmB,IAAIxB,IAChBhG,EAAiB,CAACuF,EAASkC,KACpC,IAAKlC,IAAYkC,EAAa,OAC9B,IAAIC,EAAKnC,EAAQ9G,YAAc8G,EAC3Be,EAAYf,EAAQhJ,YACpBoL,EAAOH,EAAiBnI,IAAIiH,GAC3BqB,IACDA,EAAOxC,SAASC,cAAc,YAC9BuC,EAAKC,UAAYH,EACjBD,EAAiBjI,IAAI+G,EAAWqB,IAEpCD,EAAGrC,YAAYsC,EAAKE,QAAQhB,WAAU,KAG1C,IAAIiB,EAAU,IAAIzH,QAAQ0H,GAAWA,KACxBpG,MAAAA,EAASqG,GAAOF,EAAQpH,KAAKsH,GAE7BC,EAAc,CAAChB,EAAKrE,EAAMsF,IAASjB,EAAMiB,EAAO,eAAiB,mBAAmBtF,EAAM,IAE1FuF,EAAiBC,IAC1B,IAAIT,EAAOxC,SAASC,cAAc,YAElC,OADAuC,EAAKC,UAAYQ,EACVT,GAGEU,EAAiB,CAACC,EAAMF,KACjC,IAAIT,EAAOQ,EAAeC,GAC1BE,EAAKV,UAAY,GACjBU,EAAKjD,YAAYsC,EAAKE,QAAQhB,WAAU,KAG/B0B,EAAqB,KAC9B,MAAMC,EAAQ,GACd,MAAO,CAAC1B,EAAIe,KACHW,EAAM1B,KACP0B,EAAM1B,GAAMqB,EAAeN,IAExBW,EAAM1B,GAAIe,QAAQhB,WAAU"}